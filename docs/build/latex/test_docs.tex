%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{times}
\expandafter\ifx\csname T@LGR\endcsname\relax
\else
% LGR was declared as font encoding
  \substitutefont{LGR}{\rmdefault}{cmr}
  \substitutefont{LGR}{\sfdefault}{cmss}
  \substitutefont{LGR}{\ttdefault}{cmtt}
\fi
\expandafter\ifx\csname T@X2\endcsname\relax
  \expandafter\ifx\csname T@T2A\endcsname\relax
  \else
  % T2A was declared as font encoding
    \substitutefont{T2A}{\rmdefault}{cmr}
    \substitutefont{T2A}{\sfdefault}{cmss}
    \substitutefont{T2A}{\ttdefault}{cmtt}
  \fi
\else
% X2 was declared as font encoding
  \substitutefont{X2}{\rmdefault}{cmr}
  \substitutefont{X2}{\sfdefault}{cmss}
  \substitutefont{X2}{\ttdefault}{cmtt}
\fi


\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}
\setcounter{tocdepth}{0}



\title{test\_docs Documentation}
\date{Feb 25, 2021}
\release{23.2.2021}
\author{iovius}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxAtStartPar
V tem dokumentu je zbrano gradivo laboratorijske vaje pri predmetu LMS. Dokument je namenjen branju v spletnem brskalniku, kjer tudi delujejo vse povezave. V osnovi je 9 vaj, od tega je ena (Računalniška analiza interferogramov) poteka 2 tedna.


\chapter{Prostorsko fitriranje in razširjevalnik laserskega snopa}
\label{\detokenize{prostorskofiltriranje:prostorsko-fitriranje-in-razsirjevalnik-laserskega-snopa}}\label{\detokenize{prostorskofiltriranje:prostorskofiltriranje}}\label{\detokenize{prostorskofiltriranje::doc}}
\sphinxAtStartPar
Navodila za laboratorijsko vajo so zaenkrat dostopna le v \sphinxstyleemphasis{.pdf} verziji na povezavi \sphinxcode{\sphinxupquote{Prostorsko filtriranje in razširjevalnik žarek}}

\sphinxAtStartPar
Pri tej vaji boste uporabljali polariziran \sphinxstyleemphasis{He\sphinxhyphen{}Ne} laser z valovno dolžino \sphinxstyleemphasis{633 nm} in premerom žarka \sphinxstyleemphasis{0,8 mm}.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=1.0]{{razsirjevalnik}.png}
\caption{Slika 1. Razširjevalnik žarka.}\label{\detokenize{prostorskofiltriranje:id1}}\end{figure}


\section{Naloge}
\label{\detokenize{prostorskofiltriranje:naloge}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Naravnajte \sphinxstyleemphasis{Ne\sphinxhyphen{}Ne} laser tako, da bo vzporeden z optično letvijo. Za preverbo vzporednosti uporabite zaslonko, ki ima odprtino približno \sphinxstyleemphasis{1/2} premera laserskega žarka. Zaslonko najprej postavite tik za laser in naravnajte izhodni konec laserja tako, da bo skozi zaslonko šlo čim več svetlobe. Nato zaslonko prestavite na drug konec letve in po istem postopku naravnajte drug konec laserja. Proceduro ponavljajte dokler ni laserski žarek naravnan tako, da sveti skozi zaslonko na katerikoli oddaljenosti od laserja.

\item {} 
\sphinxAtStartPar
Med zaslonko in laser postavite lečo z goriščno razdaljo \sphinxstyleemphasis{7,5 mm} tako, da njeno gorišče sovpada z zaslonko. Pri tem pustite zaslonko in laser pri miru in v vseh treh oseh premikajte le lečo tako, da bo zopet šlo skozi zaslonko čim več svetlobe.

\item {} 
\sphinxAtStartPar
Sedaj odstranite zaslonko in fotografirajte intenzitetno porazdelitev laserskega žarka na zaslonu, ki je oddaljen nekaj metrov od leče. Opišite intenzitetni vzorec. Kakšen bi moral biti v idealnem primeru? Zakaj ni takšen? Primerjajte tudi teoretični in dejanski premer oziroma divergenco žarka? Za to uporabite fotografijo, ki ste jo posneli.

\item {} 
\sphinxAtStartPar
V gorišče leče tokrat postavite zaslonko, ki ima premer približno \sphinxstyleemphasis{1,5}\sphinxhyphen{}krat večji od premera žarka v gorišču. Zopet fotografirajte žarek in opišite novo stanje.

\item {} 
\sphinxAtStartPar
Preizkusite še ostale zaslonke, ki so na voljo in pri vsaki izmerite premer prvega temnega \sphinxstyleemphasis{Airy}\sphinxhyphen{}jevega diska. Na osnovi teh izmerkov izračunajte premere zaslonk in jih primerjajte z dejanskimi.

\item {} 
\sphinxAtStartPar
Sestavite razširjevalnik žarka z ustrezno zaslonko (\sphinxstyleemphasis{d}$_{\text{zas}}$=1,5 \sphinxstyleemphasis{d}$_{\text{f}}$), tako da dodate drugo lečo z goriščnico \sphinxstyleemphasis{f} = \sphinxstyleemphasis{150 mm}. Kje mora stati, da bo na izhodu žarek kolimiran? Preverite intenzitetni profil žarka \sphinxstyleemphasis{z} in \sphinxstyleemphasis{brez} zaslonke.

\end{enumerate}


\chapter{Preračun optičnega sistema s programom OSLO LT}
\label{\detokenize{oslo:preracun-opticnega-sistema-s-programom-oslo-lt}}\label{\detokenize{oslo::doc}}
\sphinxAtStartPar
Navodila za laboratorijsko vajo so zaenkrat dostopna le v \sphinxstyleemphasis{.pdf} verziji na povezavi \sphinxcode{\sphinxupquote{Preračun optičnega sistema s programom OSLO LT}}


\section{Naloge}
\label{\detokenize{oslo:naloge}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Zmodelirate optični sistem z dvema lečama.

\item {} 
\sphinxAtStartPar
Vizualizirajte optični sistem in izrišite potek žarkovnega stožca skozi optični sistem.

\item {} 
\sphinxAtStartPar
Okarakterizirajte kvaliteto preslikave točkovnega svetlobnega izvora.

\item {} 
\sphinxAtStartPar
Naredite primerjavo treh tipov leč za primer preslikave iz neskončnosti v končnost.

\item {} 
\sphinxAtStartPar
Zmodelirajte razširjevalnik žarka.

\end{enumerate}


\section{Zagon programa}
\label{\detokenize{oslo:zagon-programa}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Ob zagonu izberite:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{1}.png}
\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{1}
\item {} 
\sphinxAtStartPar
Po potrditvi (\sphinxstyleemphasis{OK}) se v programu pojavijo tri podokna (\sphinxstyleemphasis{Surface Data}, \sphinxstyleemphasis{TW} in \sphinxstyleemphasis{GW}):

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=0.5]{{2}.png}
\end{figure}

\sphinxAtStartPar
Zadnji dve služita tekstovnemu (\sphinxstyleemphasis{TW}) in grafičnemu prikazu (\sphinxstyleemphasis{GW}) rezultatov. Okno \sphinxstyleemphasis{Surface Data} je v prvi fazi modeliranja najpomembnejše, saj vanj vnašamo geometrijske
in optične podatke proučevanega lečja.


\section{Vnos geometrijskih podatkov}
\label{\detokenize{oslo:vnos-geometrijskih-podatkov}}
\sphinxAtStartPar
1. V oknu \sphinxstyleemphasis{Surface Data} so torej shranjeni podatki optičnega sistema:
ime optičnega sistema:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{3}.png}
\end{figure}

\sphinxAtStartPar
V tabeli površin so ob pričetku že tri površine in sicer: objektna površina (\sphinxstyleemphasis{OBJ}), zaslonka (\sphinxstyleemphasis{AST}) in slikovna ravnina (\sphinxstyleemphasis{IMS}).
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{1}
\item {} 
\sphinxAtStartPar
Nove površine vnesemo z desnim klikom in ukazom \sphinxstylestrong{Insert Before} oziroma \sphinxstylestrong{Insert After}. Tako vnesite štiri nove površine med \sphinxstyleemphasis{OBJ} in \sphinxstyleemphasis{AST}. Tabela mora ob koncu imeti sledeč izgled:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{4}.png}
\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{2}
\item {} 
\sphinxAtStartPar
Določite 3. površino kot zaslonko. To storite z desnim klikom na gumb v stolpcu \sphinxstylestrong{APERTURE RADIUS}:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{5}.png}
\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{3}
\item {} 
\sphinxAtStartPar
Vnesite razdalje med posameznimi površinami tako, da spremenite vrednosti v stolpcu \sphinxstylestrong{THICKENSS}. Razdaljo med objektno ravnino in 1. lečo vnesete v prvo vrstico (\sphinxstyleemphasis{OBJ}). Debelino 1. leče vnesete kot debelino 1. površine. Tako nadaljujete z vsemi debelinami, vključno z debelino 5. površine, ki popisuje razdaljo med zadnjo optično površino in slikovno ravnino.

\end{enumerate}

\sphinxAtStartPar
5. Vnesite tudi krivinske radije posameznih površin. Zato spremenite vrednosti v stolpcu \sphinxstylestrong{RADIUS}.
.. note::
Pri tem upoštevajte dogovor o predznaku: pozitiven, če je center sfere na desni strani površine!

\sphinxAtStartPar
Ob koncu mora imeti tabela sledeč izgled:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{6}.png}
\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{5}
\item {} 
\sphinxAtStartPar
Dodajte še materialne podatke in sicer v stolpec \sphinxstylestrong{GLASS}. Prva leča je iz stekla z oznako \sphinxstyleemphasis{BK7}, zato v celico 1. površine vpišite \sphinxstyleemphasis{BK7}. Ob tem opazimo, da se je na gumbu desno pojavila oznaka \sphinxstylestrong{C}, kar pomeni, da je program oznako prepoznal in podatke črpa iz knjižnice o različnih steklih. Enako storimo tudi za drugo lečo, ki je iz stekla \sphinxstyleemphasis{SF11}:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{7}.png}
\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{6}
\item {} 
\sphinxAtStartPar
Nastavite polmer žarka na vstopu v prvo lečo. Pritisnite na gumb \sphinxstyleemphasis{SETUP} in spremenite parameter \sphinxstylestrong{Entr beam rad} na vrednost \sphinxstyleemphasis{7.5}:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{8}.png}
\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{7}
\item {} 
\sphinxAtStartPar
Poimenujte optični sistem, tako da v okno \sphinxstyleemphasis{Surface Data}, v polje \sphinxstylestrong{Lens} vpišete \sphinxstyleemphasis{LMS \textendash{} vaja 2}.

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{9}.png}
\end{figure}

\sphinxAtStartPar
Vidimo, da tabela poleg stolpcev \sphinxstylestrong{RADIUS}, \sphinxstylestrong{THICKNESS} in \sphinxstylestrong{GLASS} vsebuje tudi stolpca \sphinxstylestrong{APERTURE RADIUS} in \sphinxstylestrong{SPECIAL}. Prvi stolpec, torej \sphinxstylestrong{APERTURE RADIUS}, določa polmer posamezne optične površine, ki se ob privzetem načinu samodejno izračuna glede na polmer žarkovnega stožca. Zato je na gumbih znak \sphinxstylestrong{S}, ki pomeni \sphinxstyleemphasis{Solved}. Stolpec \sphinxstylestrong{SPECIAL} pa služi za dodatne nastavitve posamezne površine, kot so na primer asferičnost, reflektivnost, ekscentričnost in, kot bomo videli v nadaljevanju, način grafičnega prikaza.


\section{Izris optičnega sistema}
\label{\detokenize{oslo:izris-opticnega-sistema}}
\sphinxAtStartPar
Tako smo vnesli večino geometrijskih in materialnih podatkov. Čas je, da sistem izrišemo in
vizualno preverimo ustreznost podatkov.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
V ta namen pritisnemo gumb \sphinxstylestrong{Draw Off}, ki se nahaja v oknu \sphinxstyleemphasis{Surface Data}. Po pritisku se gumb preimenuje v \sphinxstylestrong{Draw On}, izriše pa se tudi okno \sphinxstyleemphasis{Autodraw}:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{10}.png}
\end{figure}

\sphinxAtStartPar
V oknu se v osrednjem delu izriše stranski pogled na optični sistem ter centralni in marginalna žarka. V glavi okna (zgoraj) je izpisano ime optičnega sistema ter goriščna razdalja in numerična odprtina slikovnega prostora (\sphinxstyleemphasis{NA}). Pri tem se numerična odprtina izračuna po enačbi:
\begin{equation*}
\begin{split}NA' = n' \cdot sin{\Phi'}\end{split}
\end{equation*}
\sphinxAtStartPar
\({n}'\) … lomni količnik medija med zadnjo lečo in slikovno ravnino, \({\Phi}'\) … prostorski kot žarkovnega snopa na izhodu iz optičnega sistema

\sphinxAtStartPar
Okno \sphinxstyleemphasis{Autodraw} osveži geometrijo ob vsaki spremembi podatkov, ki so shranjeni v \sphinxstyleemphasis{Surface Data}. Kot vidimo, je privzet način izrisa takšen, da vidimo zgolj stranski pogled leč, brez zaslonke ter objektne in slikovne ravnine.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{1}
\item {} 
\sphinxAtStartPar
Manjkajoče optične površine (zaslonko in objektno ter slikovno ravnino) izrišemo tako, da pritisnemo na gumb izbrane površine, v stolpcu \sphinxstylestrong{SPECIAL}, in izberemo \sphinxstyleemphasis{Surface Control}:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{11}.png}
\end{figure}

\sphinxAtStartPar
V oknu \sphinxstyleemphasis{Surface Data} poiščemo polje \sphinxstylestrong{Surface appearance in lens drawings} in izberemo možnost \sphinxstyleemphasis{Drawn}:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{12}.png}
\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{5}
\item {} 
\sphinxAtStartPar
Isti postopek ponovimo za ostali dve površini. Na koncu mora se mora v \sphinxstyleemphasis{Autodraw} oknu izrisati sledeča slika:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{13}.png}
\end{figure}

\sphinxAtStartPar
Sedaj vidimo, da se žarki širijo iz objektne točke, ki leži na optični osi, proti optičnemu sistemu, tako da ima snop na vstopu v 1. lečo premer 15 mm. Skozi sistem se žarki lomijo in imajo na izhodu skupno sečišče nekaj milimetrov pred slikovno ravnino. To sečišče ne sovpada s slikovno ravnino, ker smo njeno lego izračunali na osnovi paraksialne aproksimacije, marginalna žarka pa oklepata že relativno velik kot z optično osjo.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{2}
\item {} 
\sphinxAtStartPar
Nastavimo izris tako, da bomo poleg omenjenih treh žarkov videli še štiri vmesne. Izberemo meni \sphinxstyleemphasis{Lens\sphinxhyphen{}\textgreater{}Lens drawing Conditions…} Nato v oknu \sphinxstyleemphasis{Surface Data} nastavimo število objektnih točk (\sphinxstylestrong{Nuber of field points for ray fans}), iz katerih se širijo žarkovni snopi na \sphinxstyleemphasis{1}. Naš optični sistem uporabljamo zgolj za preslikavo točkovnega svetlobnega izvora, ki leži na optični osi, zato je ena objektna dovolj. Nato pa v polju pod \sphinxstylestrong{Rays} vnesemo željeno število izrisanih žarkov, torej \sphinxstyleemphasis{7}:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{14}.png}
\end{figure}

\sphinxAtStartPar
Spremenljivki \sphinxstylestrong{Min pupil} in \sphinxstylestrong{Max Pupil} določata relativno višino zgornjega in spodnjega žarka na vstopni odprtini in sicer glede na njen polmer. Po potrditvi sprememb se mora v Autodraw oknu izrisati sledeča slika:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{15}.png}
\end{figure}

\sphinxAtStartPar
Vidimo, da se žarki, ki so blizu optične osi, dejansko sekajo na slikovni ravnini, tisti bolj oddaljeni pa se zaradi sferične aberacije sekajo bližje sistemu.


\section{Karakterizacija preslikave točkovnega svetlobnega izvora}
\label{\detokenize{oslo:karakterizacija-preslikave-tockovnega-svetlobnega-izvora}}
\sphinxAtStartPar
Oddaljenost med sečiščema opazovanega in glavnega žarka s slikovno ravnino se spreminja v odvisnosti od višine opazovanega žarka na vstopni odprtini. To odvisnost lahko prikažemo grafično s tako imenovano žarkovno presečno krivuljo (\sphinxstyleemphasis{angl.: ray intercept curve}), kjer abscisna os predstavlja relativno višino žarka na vstopni odprtini (imenovana \sphinxstyleemphasis{FX} oziroma \sphinxstyleemphasis{FY}), ordinatna os pa oddaljenost (\sphinxstyleemphasis{DX} oziroma \sphinxstyleemphasis{DY}).

\sphinxAtStartPar
Spodnja slika prikazuje primer treh žarkovnih presečnih krivulj, ki pripadajo trem legam slikovne ravnine. Vidimo, da se s spreminjanjem lege slikovne ravnine spreminja naklon presečne krivulje, ne pa tudi njena ukrivljenost. Krivulja b predstavlja potek oddaljenosti, kadar je slikovna ravnina na mestu paraksialnega nastanka slike. V tem primeru sekajo žarki, ki imajo na izhodu iz leče pozitivno višino, pod glavnim žarkom (zato ima krivulja negativno vrednost).

\sphinxAtStartPar
Žarki, ki izhajajo iz spodnje strani leče, pa sekajo slikovno ravnino nad glavnim žarkom.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{16}.png}
\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
V programu \sphinxstyleemphasis{OSLO LT} izrišemo žarkovno presečno krivuljo v oknu \sphinxstyleemphasis{UW 1} (za grafični prikaz) tako, da izberemo \sphinxstylestrong{Ray Analysis} v meniju \sphinxstylestrong{Setup Window} (skrajno levi gumb, zgoraj). Nato pa izberemo \sphinxstylestrong{RIC Plot}. V oknu se nam izriše sledeč diagram:

\end{enumerate}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=1.0]{{17}.png}
\end{figure}

\sphinxAtStartPar
Dejansko sta prikazana dva diagrama: \sphinxstyleemphasis{DY(FX)} in \sphinxstyleemphasis{DX(FX)}, ki pa se za primer osno postavljene objektne točke medsebojno ne razlikujeta. Poleg tega so na vsakem diagramu tri krivulje, ki predstavljajo žarkovna presečišča za različne valovne dolžine: \sphinxstyleemphasis{modra} barva za modro svetlobo, \sphinxstyleemphasis{zelena} za zeleno in \sphinxstyleemphasis{rdeča} za rdečo barvo svetlobe. Natančne vrednosti valovnih dolžin posamezne barve lahko spreminjate v oknu \sphinxstyleemphasis{Surface Data} s klikom na gumb \sphinxstylestrong{Wavelengths}.

\sphinxAtStartPar
Iz diagrama vidimo, da se s povečevanjem vstopnega premera žarkovnega snopa vedno hitreje (po kubični odvisnosti) povečuje tudi razdalja DY oziroma DX. Maksimalna vrednost znaša približno 1 mm.

\sphinxAtStartPar
Takšen način prikazovanja optične napake je zelo učinkovit, saj lahko enostavno vidimo kakšen je še sprejemljiva velikost vstopne odprtine oziroma zaslonke.


\section{Primerjava treh tipov leč pri preslikavi iz neskončnosti v končnost}
\label{\detokenize{oslo:primerjava-treh-tipov-lec-pri-preslikavi-iz-neskoncnosti-v-koncnost}}
\sphinxAtStartPar
Primerjajte \sphinxstylestrong{bikonveksno}, \sphinxstylestrong{plankonveksno} in \sphinxstylestrong{»Best\sphinxhyphen{}Form«} lečo za primer preslikave iz neskončnosti v končnost. \sphinxstyleemphasis{Plankonveksna} in \sphinxstyleemphasis{»Best\sphinxhyphen{}Form«} leča naj bosta obrnjeni \sphinxstyleemphasis{prav} in \sphinxstyleemphasis{narobe}.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Podatke o lečah poiščite na spletu. Uporabite leče brez antirefleksnega nanosa, z goriščno razdaljo \sphinxstylestrong{50 mm} in premerom \sphinxstylestrong{1 inčo}. Material leče naj bo \sphinxstylestrong{BK7}.

\item {} 
\sphinxAtStartPar
V leče naj vstopata svetlobna snopa s polmeroma \sphinxstylestrong{2 mm} in \sphinxstylestrong{10 mm}.

\item {} 
\sphinxAtStartPar
Primerjajte radije preslikane točke v:

\end{enumerate}
\begin{itemize}
\item {} 
\sphinxAtStartPar
gorišči točki, kot jo navaja dokumentacija leče (\sphinxstyleemphasis{BFL})

\item {} 
\sphinxAtStartPar
v paraksialnem gorišču

\item {} 
\sphinxAtStartPar
na mestu najmanjše točke (\sphinxstylestrong{autofocus \textendash{} minimal RMS spot size}).

\end{itemize}


\chapter{Fizeauev interferometer}
\label{\detokenize{fizeau:fizeauev-interferometer}}\label{\detokenize{fizeau:fizeau}}\label{\detokenize{fizeau::doc}}
\sphinxAtStartPar
Navodila za laboratorijsko vajo so zaenkrat dostopna le v \sphinxstyleemphasis{.pdf} verziji na povezavi \sphinxcode{\sphinxupquote{Fizeaujev interferometer}}

\sphinxAtStartPar
Pri tej vaji boste uporabljali polariziran He\sphinxhyphen{}Ne laser z valovno dolžino \sphinxstyleemphasis{633 nm} in premerom snopa \sphinxstyleemphasis{0,8 mm}.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=1.0]{{shema}.png}
\caption{Slika 1. Shema refraktorskega Fizeau\sphinxhyphen{}jevega interferometra, kjer je kolimator leča.}\label{\detokenize{fizeau:id1}}\end{figure}


\section{Praktične naloge:}
\label{\detokenize{fizeau:prakticne-naloge}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Tik za laserski izvor postavite razširjevalnik snopa. Prva leča naj ima goriščno razdaljo \sphinxstyleemphasis{7,5 mm}, druga pa \sphinxstyleemphasis{150 mm}. Na ustrezno mesto vstavite zaslonko (premera \sphinxstyleemphasis{15 μm}) za prostorsko filtriranje žarka. Drugo lečo postavite na takšno razdaljo, da bo žarek na izhodu kolimiran.

\item {} 
\sphinxAtStartPar
Med zaslonko in drugo lečo postavite ploščati delilnik žarka tako, da se bo del žarka odbijal pravokotno na optično os laserja. Pazite da nosilec ne bo zastiral žarka.

\item {} 
\sphinxAtStartPar
Izmerite vzporednost prednje in zadnje površine planparalelnih stekel. Meritev izvedite na dveh vzorcih:
\begin{itemize}
\item {} 
\sphinxAtStartPar
kvadratno steklo dimenzij \sphinxstyleemphasis{25×25 mm} in

\item {} 
\sphinxAtStartPar
okroglo steklo premera cca \sphinxstyleemphasis{40 mm}.

\end{itemize}

\sphinxAtStartPar
V ta namen postavite vzorec za kolimator in ga naravnajte pravokotno na optično os žarka. Pogoj za to je, da se odbiti žarki preslikajo nazaj v točkovni izvor \sphinxhyphen{} odprtino zaslonke. Interferogram na zaslonu fotografirajte in določite kot nagiba med prednjo in zadnjo površino. Iz fotografije tudi določite morebitna lokalna odstopanja od ravnosti površin! Za izračun boste potrebovali tudi podatek o povečavi interferograma (njegova velikost je namreč odvisna od pozicije zaslona). Zato del kolimiranega žarka tik pred vzorcem zastrite z okroglo palico znanega premera, s čimer boste tudi na interferogramu dobili senco znane širine. Kakšen bo interferogram, če vzorec zavrtite za \sphinxstyleemphasis{90°} okrog optične osi žarka?

\item {} 
\sphinxAtStartPar
Izmerite ravnost prednje površine steklene plošče. V ta namen postavite za kolimator referenčno ploščo (okrogla klinasta prizma s kotom \sphinxstyleemphasis{2°}) in jo naravnajte tako, da se bodo žarki z zadnje površine odbili nazaj v odprtino zaslonke. Za referenčno površino dodajte še merjeno ploščo (kvadratno steklo dimenzij \sphinxstyleemphasis{25×25 mm}), ki ji predhodno pobarvajte zadnjo površino. Za to uporabite črn flomaster za pisanje po tabli. Orientirajte jo tako, kot pred tem referenčno površino! Ko bosta obe površini dovolj vzporedni, boste na interferogramu opazili interferenčne proge. S finim pozicioniranjem merjene plošče skušajte na interferogramu dobiti osem do deset prog! Interferogram fotografirajte in določite neravnost površine!

\item {} 
\sphinxAtStartPar
Merjeno površino skušajte čim bolj poravnati, tako, da bo na interferogramu vidnih čim manj interferenčnih prog. Interferogram fotografirajte, nato pa kolimacijsko lečo izmaknite tako, da bo pas izhodnega žarka oddaljen približno tri metre. Kakšen je interferogram sedaj? Razložite.

\item {} 
\sphinxAtStartPar
Kolimacijsko lečo postavite nazaj na pravo pozicijo. Očistite barvo z zadnje površine vzorca in ga ponovno vstavite v interferometer. Kakšen je interferogram sedaj. Fotografirajte in razložite!

\end{enumerate}


\chapter{Twyman\sphinxhyphen{}Greenov interferometer}
\label{\detokenize{twyman_green:twyman-greenov-interferometer}}\label{\detokenize{twyman_green:twyman-green}}\label{\detokenize{twyman_green::doc}}
\sphinxAtStartPar
Navodila za laboratorijsko vajo so zaenkrat dostopna le v \sphinxstyleemphasis{.pdf} verziji na povezavi \sphinxcode{\sphinxupquote{Twyman\sphinxhyphen{}Greenov interferometer s faznim zamikanjem}}

\sphinxAtStartPar
Pri tej vaji boste uporabljali polariziran \sphinxstyleemphasis{He\sphinxhyphen{}Ne} laser z valovno dolžino \sphinxstyleemphasis{633 nm} in premerom žarka \sphinxstyleemphasis{0.8 mm}.


\section{Praktične naloge:}
\label{\detokenize{twyman_green:prakticne-naloge}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Razširjevalnik žarka je sestavljen iz leč \sphinxstyleemphasis{f}$_{\text{1}}$= \sphinxstyleemphasis{7,5 mm} in \sphinxstyleemphasis{f}$_{\text{2}}$= \sphinxstyleemphasis{150 mm} ter zaslonke za prostorsko filtriranje žarka. Razdaljo med lečama nastavite z uporabo strižnega interferometra. V ta namen uporabite okroglo plan\sphinxhyphen{}paralelno steklo premera \sphinxstyleemphasis{40 mm}, s katero boste razdelili žarek za razširjevalnikom in žarka medsebojno prečno zamaknili, kakor je prikazano na sliki 3.6. Fotografirajte in razložite interferograme, ko je kolimacijska leča preblizu, predaleč in v pravilni poziciji.

\item {} 
\sphinxAtStartPar
Sestavite \sphinxstyleemphasis{Twyman\sphinxhyphen{}Greenov} interferometer. Pri tem uporabite ploščati delilnik žarka dimenzij \sphinxstyleemphasis{25×35 mm}, kvadratno zrcalo \sphinxstyleemphasis{25×25 mm} (kot referenčno zrcalo \textendash{} \sphinxstyleemphasis{M1}) in zrcalo (\sphinxstyleemphasis{M2}), katerega obliko površine morate izmeriti. Sestavljajte po naslednjem vrstnem redu:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Za kolimator postavite delilnik žarka pod kotom \sphinxstyleemphasis{45°}. Delilnik vpnite v prijemalo tako, da zagotovite nemoteno širjenje prepuščenega in odbitega žarka!

\item {} 
\sphinxAtStartPar
Kakšna mora biti smer polarizacije glede na delilnik žarka, da je sekundarni odboj z delilnika žarka minimalen? Skicirajte! Laserja ne obračajte, da se ne spremeni lokacija žarka glede na zaslonko v razširjevalniku žarka!

\item {} 
\sphinxAtStartPar
Zrcali postavite tako, da sta pravokotni glede na posamezen žarek. Postopek je enak, kot pri \sphinxstyleemphasis{Fizeaujevem} interferometru.

\item {} 
\sphinxAtStartPar
S finim nastavljanjem orientacije enega od zrcal skušajte doseči interferogram, ki bo imel približno deset prog orientiranih enkrat vertikalno in drugič horizontalno. Interferograma fotografirajte in razložite, kakšna je ukrivljenost valovnih front.

\end{itemize}

\item {} 
\sphinxAtStartPar
Pripravite mehanizem za fazno zamikanje zrcala \sphinxstyleemphasis{M2}. Na optično letev, za merjeno površino, namestite pozicionirno mizico z mikrometrskim vijakom. Pozicionirno mizico in nosilec merjene površine povežite z natezno vzmetjo. Razmik med obema elementoma nastavite tako, da bo vzmet raztegnjena za približno \sphinxstyleemphasis{10 \%} glede na prvotno dolžino. Preverite, da so vse mehanske komponente dobro pritrjene! Slabo stisnjeni kontaktni spoji imajo namreč izrazito nelinearno karakteristiko deformacije v odvisnosti od obremenitve. Sprva je krivulja strma, nato pa vedno položnejša. Še večjo nevšečnost predstavlja kontaktno trenje, ki rezultira k veliki histerezi omenjene karakteristike.

\item {} 
\sphinxAtStartPar
Opravite umeritev aktuacijskega mehanizma tako, da povečate fazo merilnemu žarku petkrat po \({2\pi}\) in pri tem izmerite potreben pomik pozicionirne mizice. Spremembo faze izmerite s štetjem interferenčnih maksimumov. Rezultat umeritve prikažite na diagramu \({\Delta\phi}\) (sprememba faze) v odvisnosti od \({\Delta x_{poz.miz}}\) (premik pozicionirne mizice). V kolikor je nelinearnost večja od \sphinxstyleemphasis{20 \%}, preverite pritrditev vseh komponent. Poizkusite tudi s povečanjem prednapetja natezne vzmeti.

\item {} 
\sphinxAtStartPar
Fotoaparat brez objektiva namestite na mesto kjer sicer uporabljate zaslon za vizualno opazovanje interferograma. Preverite, da je na fotoaparatu izbran ročni način osvetlitve (program \sphinxstyleemphasis{M}), ter da je občutljivost \sphinxstyleemphasis{ISO} enaka \sphinxstyleemphasis{100} ter izbran najkrajši čas osvetlitve (\sphinxstyleemphasis{1/4000 s}). Interferogram centrirajte na sredino senzorskega elementa s premikanjem nosilne plošče fotoaparata. Pri tem imejte na fotoaparatu vključen predogled slike (\sphinxstyleemphasis{angl.: Liveview}). Izvedite poskusno fotografijo in preverite osvetljenost slike. V ta namen uporabite histogram intenzitete, ki ga fotoaparat prikaže ob posneti sliki. Rdeča barva se nikakor ne sme prelivati v rumeno oziroma belo! Če se to vseeno zgodi, dodajte pred fotoaparat atenuator \textendash{} zatemnjeno steklo.

\item {} 
\sphinxAtStartPar
Zrcalo \sphinxstyleemphasis{M2} naravnajte tako, da bo približno \sphinxstyleemphasis{8} interferenčnih prog v vertikalni smeri in posnemite serijo 10\sphinxhyphen{}ih fotografij, med katerimi povečujete fazo po \({\pi/2}\)! Med meritvijo skušajte zagotoviti čim boljše pogoje v smislu zmanjšanja vibracij. Na koncu serijo fotografij vizualno preverite v smislu kontrole enakomernega premikanja interferenčnih prog v vertikalni smeri.

\end{enumerate}


\chapter{Uvod v računalniško obdelavo slik}
\label{\detokenize{uvod_py_opencv:uvod-v-racunalnisko-obdelavo-slik}}\label{\detokenize{uvod_py_opencv:uvod-py-opencv}}\label{\detokenize{uvod_py_opencv::doc}}
\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Če še nimate nameščenega \sphinxstyleemphasis{Python}\sphinxhyphen{}a in \sphinxstyleemphasis{OpenCV}\sphinxhyphen{}ja sledite navodilom na povezavi: \DUrole{xref,std,std-ref}{navodila\_python}.
\end{sphinxadmonition}

\sphinxAtStartPar
Na tej vaji se boste spoznali z osnovnimi koncepti računalniške obdelave slik, programskim jezikom \sphinxstyleemphasis{Python} (predpostavljamo, da ste osnovno znanje že osvojili pri predmetu \sphinxhref{https://jankoslavic.github.io/pypinm.io/}{Programiranje in numerične metode v ekosistemu Pythona}) in predvsem s programsko knjižnico \sphinxstyleemphasis{OpenCV}.


\section{Uvod}
\label{\detokenize{uvod_py_opencv:uvod}}
\sphinxAtStartPar
\sphinxstylestrong{OpenCV} (\sphinxstyleemphasis{Open Source Computer Vision Library}) je knjižnica programskih funkcij, ki je v osnovi namenjena procesiranju slik v realnem času. Gre za cross\sphinxhyphen{}platform knjižnjico in je \sphinxhref{https://en.wikipedia.org/wiki/Apache\_License}{prosta za uporabo}. Prav v tem leži ena njenih največjih prednosti, saj jo lahko uporabljamo v različnih programskih jezikih (\sphinxhref{https://en.wikipedia.org/wiki/C\%2B\%2B}{C++}, \sphinxhref{https://en.wikipedia.org/wiki/C\%2B\%2B}{Python}, \sphinxhref{https://en.wikipedia.org/wiki/Java\_(programming\_language)}{Java}, \sphinxhref{https://en.wikipedia.org/wiki/MATLAB}{MATLAB}) in v različnih operacijskih sistemih (\sphinxhref{https://en.wikipedia.org/wiki/Microsoft\_Windows}{Windows}, \sphinxhref{https://en.wikipedia.org/wiki/Linux}{Linux}, \sphinxhref{https://en.wikipedia.org/wiki/MacOS}{macOS}, \sphinxhref{https://en.wikipedia.org/wiki/Android\_(operating\_system)}{Android}, \sphinxhref{https://en.wikipedia.org/wiki/IOS}{iOS}).

\sphinxAtStartPar
Na današnji vaji bomo spoznali osnovno fukcionalnost, trike in pasti.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Kot velikokrat v življenju, tudi v programiraju velja, da do končnega cilja ne vodi le ena (pravilna) pot, ampak je le\sphinxhyphen{}teh (skorajda \sphinxstyleemphasis{neskončno}) mnogo. Različne poti se lahko bolj ali manj primerne, boli ali manj upoštavajo različne konvencije ipd… Pri predmetu LMS se bomo poskušali čim bolj držati pravil, ki ste jih spoznali pri predmetu \sphinxhref{https://jankoslavic.github.io/pypinm.io/}{Programiranje in numerične metode v ekosistemu Pythona}); včasih najbrž neuspešno. Koda, ki jo bomo pisali bo daleč od optimalne Python kode, ampak bo zelo \sphinxstyleemphasis{skriptna} in čim bolj podobna \sphinxhref{https://en.wikipedia.org/wiki/Pseudocode}{pseudo kodi}.
\end{sphinxadmonition}


\subsection{Vaja 1: branje in pisanje slik z diska}
\label{\detokenize{uvod_py_opencv:vaja-1-branje-in-pisanje-slik-z-diska}}
\sphinxAtStartPar
Napišimo za začetek enostaven \sphinxstyleemphasis{Python} skripto, ki bo z diska prebrala sliko in jo prikazala.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}

\PYG{n}{image} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/home/iovius/Downloads/Lenna\PYGZus{}(test\PYGZus{}image).png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{my image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{image}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{destroyAllWindows}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Če pogedamo sedaj vrstico po vrstico.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}
\end{sphinxVerbatim}

\sphinxAtStartPar
V prvi vrstici vljučimo \sphinxstyleemphasis{OpenCV}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{image} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/home/iovius/Downloads/Lenna\PYGZus{}(test\PYGZus{}image).png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
V vrstici \sphinxstyleemphasis{3} preberemo sliko z diska s klicom \sphinxcode{\sphinxupquote{cv2.imread()}}. \sphinxcode{\sphinxupquote{cv.}} pomeni, da bomo sedaj klicali funkcijo iz knjičnice, \sphinxcode{\sphinxupquote{imread}} pa je ime funkcije. Vidite lahko, da funkcija sprejme samo en argument. Ta je tipa string in opisuje pot na disku do slike.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Ta navodila so pisana v \sphinxstyleemphasis{OS} \sphinxstyleemphasis{Ubuntu/Linux}. Zato so vse poti napisane v Linux “stilu”. Če uporabaljte \sphinxstyleemphasis{OS} \sphinxstyleemphasis{Windows}, je zadeva nekoliko bolj zapletena. Za opisovanje poti imate nekako 3 možnosti. Recimo, da je vaša slika na lokaciji \sphinxcode{\sphinxupquote{"C:\textbackslash{}SomeFolder\textbackslash{}SomeOtherFolder\textbackslash{}my\_image.jpg"}}.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
pot podate z dvojno levo poševnico (\sphinxstyleemphasis{backslash}\sphinxhyphen{}om), torej: \sphinxcode{\sphinxupquote{"C:\textquotesingle{}\textbackslash{}\textbackslash{}SomeFolder\textbackslash{}\textbackslash{}SomeOtherFolder\textbackslash{}\textbackslash{}my\_image.jpg"}}

\item {} 
\sphinxAtStartPar
pot podate s poševnico (\sphinxstyleemphasis{slash}\sphinxhyphen{}om), torej: \sphinxcode{\sphinxupquote{"C:/SomeFolder/SomeOtherFolder/my\_image.jpg"}}

\item {} 
\sphinxAtStartPar
pot podate kot \sphinxstyleemphasis{dobeseden string} (\sphinxstyleemphasis{literal string}), torej: \sphinxcode{\sphinxupquote{r"C:\textbackslash{}SomeFolder\textbackslash{}SomeOtherFolder\textbackslash{}my\_image.jpg"}}

\end{enumerate}

\sphinxAtStartPar
Težava je v tem, da če pot kopirate, bodo v imenu leve poševnice, ti pa so rezervisani za \sphinxstyleemphasis{posebne znake} (\sphinxstyleemphasis{special characters}, npr. \sphinxcode{\sphinxupquote{"\textbackslash{}n"}} pomeni novo vrstico, \sphinxcode{\sphinxupquote{"\textbackslash{}t"}} pomeni \sphinxstyleemphasis{tab}, \sphinxcode{\sphinxupquote{"\textbackslash{}s"}} presledek itd…).
Python ne loči med \sphinxcode{\sphinxupquote{"}} in \sphinxcode{\sphinxupquote{\textquotesingle{}}}, torej lahko uporabljete kateregakoli, morata pa biti \sphinxstylestrong{v paru enaka znaka}.
\end{sphinxadmonition}

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
Ne glede na operacijski sistem pa \sphinxstylestrong{morate podati celotno pot; torej od diska do končnice!} Izjema so t.i. \sphinxstyleemphasis{relativne poti}.
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{my image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{image}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
V četrti vrstici sliko prikažemo s klicom funkcije \sphinxcode{\sphinxupquote{cv2.imshow()}}. Funkcija ima 2 parametra: prvi je ime okna (glej \sphinxstyleemphasis{sliko 1}), z drugim pa podamo sliko/matriko, ki jo želimo izrisati.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.8]{{Lenna_(test_image)}.png}
\caption{Slika 1. Prikazana slika.}\label{\detokenize{uvod_py_opencv:id2}}\end{figure}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Slike so v računalništvu matrike. Če ima slika \sphinxstyleemphasis{640x480} (\sphinxstyleemphasis{širina} x \sphinxstyleemphasis{višina}) pikslov, imamo torej matriko \sphinxstyleemphasis{480x640} (pazite, pri matrikah \sphinxstylestrong{najprej podamo štelivo vrstic, potem število stolpcev!}) kjer vrednost vsakega elementa popoisuje intenziteto posameznega piksla (v primeru sivinske \sphinxhyphen{} \sphinxstyleemphasis{grayscale} slike). Če imamo opravka z barvno sliko (npr. \sphinxstyleemphasis{RGB} barvni model) imamo 3 matrike, po eno za posamezen kanal (barvo).
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
V peti vrstici s fukcijo \sphinxcode{\sphinxupquote{cv2.waitKey()}} čakamo na pritisk katerikoli tipke.
Če pogledamo v \sphinxhref{https://docs.opencv.org/4.0.0/d7/dfc/group\_\_highgui.html\#ga5628525ad33f52eab17feebcfba38bd7}{dokumentacijo} fukcije, je tam zapisamo \sphinxcode{\sphinxupquote{retval = cv.waitKey({[}, delay{]} )}}. Branje in razumevanje dokumentacije je ena najpomembnejših vrlin, ki jo kot programerji moramo osvojiti. Poglejmo, kaj lahko iz tega razberemo. Znotaj \sphinxcode{\sphinxupquote{()}} vidimo \sphinxcode{\sphinxupquote{{[}, delay{]}}}. To pomeni, da fukcija sprejme 1 argument, ki pa je opcijski (to povesta \sphinxcode{\sphinxupquote{{[}{]}}}): to pomeni, da ga lahko podamo, ni pa nujno. Če nadalnje preberemo dokumentacijo piše: \sphinxstyleemphasis{“The function waitKey waits for a key event infinitely (when delay≤0 ) or for delay milliseconds, when it is positive.”}. Torej, če argumenta \sphinxcode{\sphinxupquote{delay}} ne podamo, bo funkcija čakala na pritist tipke “v neskončnost”, če pa jo, bo počakala samo število milisekund, kot smo ga podali s parametrom \sphinxcode{\sphinxupquote{delay}}.
Vidimo lahko tudi, da fukcija vrne \sphinxcode{\sphinxupquote{retval}}. V dokumentacij piše: \sphinxstyleemphasis{“It returns the code of the pressed key or \sphinxhyphen{}1 if no key was pressed before the specified time had elapsed.”}. Ugotovimo lahko, katero tipko smo pritisni (vrne \sphinxstylestrong{ASCII} kodo, najdete jo lahko v stolpcu \sphinxstylestrong{Dec} v \sphinxhref{https://en.wikipedia.org/wiki/ASCII\#Printable\_characters}{tabeli}, ali s \sphinxstyleemphasis{Python} klicom \sphinxcode{\sphinxupquote{ord(\textquotesingle{}\textless{}vaša črka\textgreater{}\textquotesingle{})}}).

\sphinxAtStartPar
Po 5. vrstici bi se torej izvajanje programa moralo ustaviti in prikazati sliko. Ko pritisnemo tipko ze izvajanje skripte nadaljuje z zadnjo vrstico, kjer vsa odprta okna zapremo.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Če ne kličemo funkcije \sphinxcode{\sphinxupquote{cv2.destroyAllWindows()}} običajno okno ostane odprto in neodzivno (ne moremo ga zapreti), kar je lahko moteče.
\end{sphinxadmonition}

\sphinxAtStartPar
Kot lahko vidimo, je prikazana slika barvna, torej jo sestavljajo 3 kanali, rdeč, zelen in model. Dopolnimo skripto tako, da sliko razdelimo na posamezne kanale, jih prikažemo, premešamo in sliko spet shranimo.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}

\PYG{n}{image} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/home/iovius/Downloads/Lenna\PYGZus{}(test\PYGZus{}image).png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{p}{[}\PYG{n}{blue}\PYG{p}{,} \PYG{n}{green}\PYG{p}{,} \PYG{n}{red}\PYG{p}{]} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{n}{image}\PYG{p}{)}
\PYG{n}{image\PYGZus{}merged} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{p}{[}\PYG{n}{red}\PYG{p}{,} \PYG{n}{green}\PYG{p}{,} \PYG{n}{blue}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{red}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{red}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{green}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{green}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blue}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{blue}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{my image}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{image}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{image merged}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{image\PYGZus{}merged}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imwrite}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/home/iovius/Downloads/Lenna\PYGZus{}(test\PYGZus{}image).png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{image\PYGZus{}merged}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{destroyAllWindows}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Dodali smo vrstice \sphinxstyleemphasis{5\sphinxhyphen{}10}, \sphinxstyleemphasis{12} in \sphinxstyleemphasis{15}.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Čeprav običajo slišite “RGB”, \sphinxstyleemphasis{OpenCV} uporablja zaporedje \sphinxstylestrong{blue, green, red}.
\end{sphinxadmonition}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{Lenna+merged}.png}
\caption{Slika 2. Originalna \sphinxstyleemphasis{Lenna} in \sphinxstyleemphasis{Lenna} s premešanimi kanali.}\label{\detokenize{uvod_py_opencv:id3}}\end{figure}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{channels}.png}
\caption{Slika 3. Posamezni kanali.}\label{\detokenize{uvod_py_opencv:id4}}\end{figure}


\subsection{Vaja 2: zajemanje in prikazovanje slike s kamere}
\label{\detokenize{uvod_py_opencv:vaja-2-zajemanje-in-prikazovanje-slike-s-kamere}}
\sphinxAtStartPar
V tem delu vaje bomo pogledali, kako s pomočjo \sphinxstyleemphasis{OpenCV}\sphinxhyphen{}ja zajamemo sliko s kamere, ki je priklopljena na računalnik.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}

\PYG{n}{cam} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{VideoCapture}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{n}{flip} \PYG{o}{=} \PYG{k+kc}{False}

\PYG{k}{while} \PYG{k+kc}{True}\PYG{p}{:}
    \PYG{n}{retval}\PYG{p}{,} \PYG{n}{frame} \PYG{o}{=} \PYG{n}{cam}\PYG{o}{.}\PYG{n}{read}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{retval}\PYG{p}{:}
        \PYG{k}{break}
    \PYG{k}{if} \PYG{n}{flip}\PYG{p}{:}
        \PYG{n}{frame} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{flip}\PYG{p}{(}\PYG{n}{frame}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{frame}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{frame}\PYG{p}{)}
    \PYG{n}{key} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{key} \PYG{o}{==} \PYG{l+m+mi}{27}\PYG{p}{:}
        \PYG{k}{break}
    \PYG{k}{elif} \PYG{n}{key} \PYG{o}{==} \PYG{n+nb}{ord}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{flip} \PYG{o}{=} \PYG{o+ow}{not} \PYG{n}{flip}
        
        
\PYG{n}{cam}\PYG{o}{.}\PYG{n}{release}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{destroyAllWindows}\PYG{p}{(}\PYG{p}{)}
    
\end{sphinxVerbatim}

\sphinxAtStartPar
Skripta je sedaj nekoliko daljša.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cam} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{VideoCapture}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Najpomembnejša razlika v primerjavi s prejšnjo skripto je vrstica \sphinxstyleemphasis{3}. \sphinxcode{\sphinxupquote{VideoCapture}} je \sphinxhref{https://en.wikipedia.org/wiki/Class\_(computer\_programming)}{razred} za zajem videa iz različnih video datotek, sekvenc slik in \sphinxstyleemphasis{hardware}\sphinxhyphen{}a \sphinxhyphen{} kamer. Če podrobneje pogledamo \sphinxhref{https://docs.opencv.org/3.4/d8/dfe/classcv\_1\_1VideoCapture.html\#details}{dokumentacij} omenjenega razreda lahko vidimo, da imamo na voljo 5 razlčnih \sphinxhref{https://en.wikipedia.org/wiki/Constructor\_(object-oriented\_programming)}{konstruktorjev} :
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{\textless{}VideoCapture object\textgreater{} = cv.VideoCapture( )}} … \sphinxstyleemphasis{default} konstruktor, za enkrat za nas ni zanimiv

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{\textless{}VideoCapture object\textgreater{} = cv.VideoCapture( filename )}} … “odpremo” video datototeko

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{\textless{}VideoCapture object\textgreater{} = cv.VideoCapture( filename, apiPreference   )}} … “odpremo” video datototeko in določimo s katero \sphinxstyleemphasis{video} knjižnico

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{\textless{}VideoCapture object\textgreater{} = cv.VideoCapture( index )}} … “odpremo” kamero

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{\textless{}VideoCapture object\textgreater{} = cv.VideoCapture( index, apiPreference )}} … “odpremo” kamero in določimo s katero \sphinxstyleemphasis{video} knjižnico

\end{enumerate}

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
Kadarkoli “odpremo” nek kos \sphinxstyleemphasis{hardware}\sphinxhyphen{}a, ga moramo potem tudi zapreti (glejte vrstico \sphinxstyleemphasis{20}). Če tega ne storimo, v ob naslednjem poskusu odpiranja to ne bo mogoče, saj je npr. kamera že odprta. Tudi v dokumentaciji piše: \sphinxstyleemphasis{In C API, when you finished working with video, release CvCapture structure with cvReleaseCapture()…}
\end{sphinxadmonition}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Dokumentacija \sphinxstyleemphasis{OpenCV}\sphinxhyphen{}ja je primarno napisana za \sphinxstyleemphasis{C++}; za \sphinxstyleemphasis{Python} je precej skopa in moramo velikokrat prebrati kaj piše za \sphinxstyleemphasis{C++} in to “preversti” v \sphinxstyleemphasis{Python}.
\end{sphinxadmonition}

\sphinxAtStartPar
V vrstici \sphinxstyleemphasis{3} lahko vidite, da smo uporabiti opcijo \sphinxstyleemphasis{4}. \sphinxcode{\sphinxupquote{index}} je tipa \sphinxcode{\sphinxupquote{int}} in določa, katero kamero želimo odpreti.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
\sphinxstyleemphasis{Python} tako kot vsak resen programski jezik začenja šteti z \sphinxstylestrong{0} in ne z \sphinxstylestrong{1} (\sphinxstyleemphasis{I’m looking at you, MATLAB!}); torej, \sphinxstyleemphasis{index prvega elementa} je \sphinxstyleemphasis{0}!
\end{sphinxadmonition}

\sphinxAtStartPar
Klic nam vrne \sphinxhref{https://en.wikipedia.org/wiki/Object\_(computer\_science)}{objekt} tipa \sphinxstyleemphasis{VideoCapture}, ki ga “ujamemo” v spremenljivo \sphinxcode{\sphinxupquote{cam}}. V vrstivi 6 začnemo neskončno \sphinxstylestrong{while} zanko.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
    \PYG{n}{retval}\PYG{p}{,} \PYG{n}{frame} \PYG{o}{=} \PYG{n}{cam}\PYG{o}{.}\PYG{n}{read}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
V vrstici \sphinxstyleemphasis{7} kličemo metodo razreda \sphinxstyleemphasis{VideoCapture} \sphinxcode{\sphinxupquote{read()}}. V dokumentaciji lahko preberemo, da metoda \sphinxstyleemphasis{Grabs, decodes and returns the next video frame.}. Sintaksa je zapisana kot \sphinxcode{\sphinxupquote{retval, image = cv.VideoCapture.read( {[}, image{]} )}}. Spet lahko vidimo, da sprejme en opcijski parameter \sphinxcode{\sphinxupquote{image}}, ki pa ga lahko “ujamemo” tudi na izhodnji strani. Glede \sphinxcode{\sphinxupquote{retval}} pa piše \sphinxstyleemphasis{false if no frames has been grabbed}. Tako v vrsticah \sphinxstyleemphasis{8\sphinxhyphen{}9} preverim, ali je branje uspelo in če ni \sphinxstyleemphasis{neskončno} zanko zaključimo.

\sphinxAtStartPar
V vrstici \sphinxstyleemphasis{10} preverimo, kakšno je treutno stanje spremenljivke \sphinxcode{\sphinxupquote{flip}} in eventuelno izvedemo vrstico \sphinxstyleemphasis{11}. \sphinxstylestrong{Vaša naloga je}, da na spletu poiščete dokumentacijo \sphinxstyleemphasis{OpenCV} funkcije \sphinxcode{\sphinxupquote{cv2.flip()}} in \sphinxstylestrong{ugotovite}, kaj funkcija naredi in kaj sta oba parametra.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
    \PYG{k}{if} \PYG{n}{key} \PYG{o}{==} \PYG{l+m+mi}{27}\PYG{p}{:}
        \PYG{k}{break}
    \PYG{k}{elif} \PYG{n}{key} \PYG{o}{==} \PYG{n+nb}{ord}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{flip} \PYG{o}{=} \PYG{o+ow}{not} \PYG{n}{flip}
\end{sphinxVerbatim}

\sphinxAtStartPar
V vrsticah \sphinxstyleemphasis{14\sphinxhyphen{}17} imamo 2 klica povezana s tipko, ki smo jo (eventuelno) pritisnili v vrstici \sphinxstyleemphasis{13}. \sphinxstyleemphasis{27} je koda tipke \sphinxstyleemphasis{ESC} in v tem primeru zanko zaključimo, če pa pritisnemo tipko \sphinxstyleemphasis{f} spremenimo \sphinxstyleemphasis{True/False} stanje spremenljivke \sphinxcode{\sphinxupquote{flip}}.


\subsection{Vaja 3: globina slike (\sphinxstyleemphasis{image depth}) in prikazovanje slike}
\label{\detokenize{uvod_py_opencv:vaja-3-globina-slike-image-depth-in-prikazovanje-slike}}
\sphinxAtStartPar
Če uporabljate \sphinxstyleemphasis{Jupyter Notebook}, spremenljivke ostanejo v spominu tudi, ko se izvajanje skripte konča. V naslednjo celico napišite klic:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
print(type(frame[0, 0, 0]))

output: \PYGZlt{}class \PYGZsq{}numpy.uint8\PYGZsq{}\PYGZgt{}
\end{sphinxVerbatim}

\sphinxAtStartPar
Slika v spremenljivki \sphinxcode{\sphinxupquote{frame}} je v resnici trodimenzionalna matrika, vredsnoti znotraj oglatih oklepajev pa koordinata piksla, ki ga želimo izpisati: \sphinxstyleemphasis{prva} vrednost določa vrstico, \sphinxstyleemphasis{druga} stolpec in \sphinxstyleemphasis{tretja} kanal, če imamo RGB sliko. Če je slika sivinska moramo podati samo 2 vrednosti. Vidimo lahko, da je element tipa \sphinxcode{\sphinxupquote{uint8}}. To pomeni, da je \sphinxstyleemphasis{unsigned integer} (celo število brez predznaka) popisan z osmimi biti. Najmanjša vrednost, ki jo torej lahko opišemo je torej ‘0’ (binarno \sphinxstyleemphasis{0000 0000}, hex \sphinxstyleemphasis{00}), največja pa \sphinxstyleemphasis{255} (binarno \sphinxstyleemphasis{1111 1111}, hex \sphinxstyleemphasis{ff}). \sphinxstylestrong{Vprašanje:} kaj se zgodi, če \sphinxstyleemphasis{uint8} spemelnjivki z vrednostjo \sphinxstyleemphasis{255} prištejemo \sphinxstyleemphasis{1}?

\sphinxAtStartPar
Napišimo kratko skripto, ki bo izrisala 3 slike: črno, sivo in belo.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{cv2}

\PYG{n}{dimensions} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{500}\PYG{p}{,}\PYG{l+m+mi}{500}\PYG{p}{]}

\PYG{n}{black} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{n}{dimensions}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{uint8}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mi}{0}
\PYG{n}{gray} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{n}{dimensions}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{uint8}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mi}{126}
\PYG{n}{white} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{n}{dimensions}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{uint8}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mi}{255}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{white}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{gray}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{black}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{destroyAllWindows}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Kot lahko vidite, smo sedaj uvozili še eno knjižnico, \sphinxhref{https://numpy.org/}{numpy} (vrstica \sphinxstyleemphasis{1}). Gre za “\sphinxstyleemphasis{The fundamental package for scientific computing with Python}”. Ker je njeno ime dolgo, ga okrajšamo, tako da jo lahko kličemo kot \sphinxcode{\sphinxupquote{np.}}.
V vrstici \sphinxstyleemphasis{4} določimo dmenzije slik. V vrsticah \sphinxstyleemphasis{6\sphinxhyphen{}8}, naredimo najprej 3 matrike enic, ki jih potem pomnožimo z \sphinxstyleemphasis{0} za črno sliko, \sphinxstyleemphasis{126} za sivo in \sphinxstyleemphasis{255} za belo. Ko slike izrišemo, vidimo nekaj takega:

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.4]{{w_s_b}.png}
\caption{Slika 4. Bela, siva in črna generirana slika.}\label{\detokenize{uvod_py_opencv:id5}}\end{figure}

\sphinxAtStartPar
V vrsticah \sphinxstyleemphasis{6\sphinxhyphen{}8} smo nastavili, da je posamezen element matrik tipa \sphinxcode{\sphinxupquote{uint8}}. To imenujemo \sphinxstylestrong{image depth} (v prostem prevodu \sphinxstyleemphasis{“globina”} \sphinxstyleemphasis{slike}). Spremenimo sedaj \sphinxstyleemphasis{globino} naših slik v \sphinxcode{\sphinxupquote{float32}}, torej število s plavajočo vejico in 32 biti, in skripto ponovno poženimo.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.4]{{w_s_b_f32}.png}
\caption{Slika 5. Enake 3 slike kot na \sphinxstyleemphasis{sliki 4}, le da so sedaj v formatu \sphinxstyleemphasis{float32}.}\label{\detokenize{uvod_py_opencv:id6}}\end{figure}

\sphinxAtStartPar
Opazimo lahko, da sta sedaj tako slika \sphinxstyleemphasis{gray} kot slika \sphinxstyleemphasis{white} beli. Zakaj?

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
\sphinxstylestrong{Zapomnite si:} če z \sphinxstyleemphasis{OpenCV} funkcijo \sphinxcode{\sphinxupquote{imshow()}} izrisujemo slike \sphinxstyleemphasis{globine} \sphinxstylestrong{integer}, bo \sphinxstylestrong{0 … črna}, \sphinxstylestrong{255 … bela}, če pa izrisujemo slike \sphinxstyleemphasis{globine} \sphinxstylestrong{float}, bo \sphinxstylestrong{0.0 … črna}, \sphinxstylestrong{1.0 … bela}!
\end{sphinxadmonition}


\subsection{Vaja 4: filtriranje slik}
\label{\detokenize{uvod_py_opencv:vaja-4-filtriranje-slik}}
\sphinxAtStartPar
Pri procesiranju slik se pogosto poslužujemo različnih filtriranj. Filtriranje običajno temelji na principu \sphinxhref{https://towardsdatascience.com/intuitively-understanding-convolutions-for-deep-learning-1f6f42faee1}{konvolucije}. V \sphinxstyleemphasis{OpenCV}\sphinxhyphen{}ju imamo na voljo različne predefinirane filtre, lahko pa ga ustvarimo sami. Karakteristike filtra določa njegovo \sphinxstyleemphasis{jedro} (\sphinxstyleemphasis{angl. kernel}). Poglejmo si primer enega najbolj uporablajnih filtrov \sphinxhyphen{} \sphinxstyleemphasis{Gaussov filter}.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}

\PYG{n}{image} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imread}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/home/iovius/Documents/docs/source/uvod\PYGZus{}v\PYGZus{}py/images/Lenna\PYGZus{}(test\PYGZus{}image).png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{image} \PYG{o}{=} \PYG{n}{image}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}

\PYG{n}{image\PYGZus{}filter\PYGZus{}1} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{GaussianBlur}\PYG{p}{(}\PYG{n}{image}\PYG{p}{,}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{)}

\PYG{n}{kernel} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{getGaussianKernel}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{CV\PYGZus{}32F}\PYG{p}{)}
\PYG{n}{image\PYGZus{}filter\PYGZus{}2} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{sepFilter2D}\PYG{p}{(}\PYG{n}{image}\PYG{p}{,}\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{CV\PYGZus{}32F}\PYG{p}{,}\PYG{n}{kernel}\PYG{p}{,}\PYG{n}{kernel}\PYG{p}{)}

\PYG{n}{difference} \PYG{o}{=} \PYG{n}{image\PYGZus{}filter\PYGZus{}1} \PYG{o}{\PYGZhy{}} \PYG{n}{image\PYGZus{}filter\PYGZus{}2}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{kernel:}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{kernel}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{difference:}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{difference}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{kernel}\PYG{p}{:}
 \PYG{p}{[}\PYG{p}{[}\PYG{l+m+mf}{0.17820325}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.21052228}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.22254895}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.21052228}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.17820325}\PYG{p}{]}\PYG{p}{]}

\PYG{n}{difference}\PYG{p}{:}
 \PYG{l+m+mf}{0.0}
\end{sphinxVerbatim}

\sphinxAtStartPar
V vrstici \sphinxstyleemphasis{7} uporabimo predefiniran \sphinxstyleemphasis{Gaussov} filter v funkciji \sphinxcode{\sphinxupquote{GaussianBlur}}. Medtem v vrstici 9 generiramo eno\sphinxhyphen{}dimenzionalen Gaussov filter z enakimi parametri, potem pa ga uporabimo v \sphinxcode{\sphinxupquote{sepFilter2D}}. Tej funkciji podamo posebej tilter v \sphinxstyleemphasis{X} in \sphinxstyleemphasis{Y} smeri. V \sphinxstyleemphasis{output} oknu lahko vidimo izpisa; vrednosti \sphinxstyleemphasis{kernela} in pa razliko med obema slikama, ki nam potrdi, da smo v obeh primerih sliko enako sfiltrirali.

\sphinxAtStartPar
Naredimo sedaj lasten \sphinxstyleemphasis{Moving Average} filter.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}

\PYG{n}{image} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros}\PYG{p}{(}\PYG{p}{(}\PYG{l+m+mi}{500}\PYG{p}{,}\PYG{l+m+mi}{500}\PYG{p}{)}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}
\PYG{n}{image}\PYG{p}{[}\PYG{l+m+mi}{200}\PYG{p}{:}\PYG{l+m+mi}{300}\PYG{p}{,} \PYG{l+m+mi}{200}\PYG{p}{:}\PYG{l+m+mi}{300}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mf}{1.0}

\PYG{n}{kernel} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{p}{(}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{)}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{float32}\PYG{p}{)}
\PYG{n}{kernel} \PYG{o}{/}\PYG{o}{=} \PYG{n}{kernel}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{kernel}\PYG{p}{)}

\PYG{n}{image\PYGZus{}filt} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{filter2D}\PYG{p}{(}\PYG{n}{image}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{kernel}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{image}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{image}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{filtered}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{image\PYGZus{}filt}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{destroyAllWindows}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446} \PYG{l+m+mf}{0.00826446}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\sphinxAtStartPar
V vrsticah \sphinxstyleemphasis{7} in \sphinxstyleemphasis{8} generiamo \sphinxstyleemphasis{11x11} matriko enic in jo v normaliziramo (vsota vseh uteži mora biti \sphinxstyleemphasis{1.0}). Na \sphinxstyleemphasis{sliki 6} sta prikazani izvorna in filtrirana slika.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{moving_average}.png}
\caption{Slika 6. Izvorna in filtrirana slika.}\label{\detokenize{uvod_py_opencv:id7}}\end{figure}


\section{Median filter}
\label{\detokenize{uvod_py_opencv:median-filter}}
\sphinxAtStartPar
\sphinxstyleemphasis{Median} filter je filter, kjer aktivnemu pikslu pripišemo vrednost mediane znotraj konvolucijskega okna. Gre za filter, s katerim lahko odstranimo npr. termičen šum.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}

\PYG{n}{dimensions} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{]}
\PYG{n}{N} \PYG{o}{=} \PYG{l+m+mi}{100}

\PYG{n}{image} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{n}{dimensions}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{uint8}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mi}{126}

\PYG{n}{ind\PYGZus{}v} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{dimensions}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{N}\PYG{p}{)}
\PYG{n}{ind\PYGZus{}u} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{dimensions}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{N}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{l+m+mi}{0} \PYG{o}{==} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{image}\PYG{p}{[}\PYG{n}{ind\PYGZus{}v}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{ind\PYGZus{}u}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{0}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{image}\PYG{p}{[}\PYG{n}{ind\PYGZus{}v}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{ind\PYGZus{}u}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{255}

\PYG{n}{image\PYGZus{}med} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{medianBlur}\PYG{p}{(}\PYG{n}{image}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{)}
    
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{image}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{image}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{image\PYGZus{}med}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{image\PYGZus{}med}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{destroyAllWindows}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{median}.png}
\caption{Slika 7. Izvorna in filtrirana slika z \sphinxstyleemphasis{median} filtrom.}\label{\detokenize{uvod_py_opencv:id8}}\end{figure}


\subsection{Vaja 5: \sphinxstyleemphasis{kopiranje} slik}
\label{\detokenize{uvod_py_opencv:vaja-5-kopiranje-slik}}
\sphinxAtStartPar
Ustvarite povsem črno sliko in jo kopirajte. Potem na kopiji nekaj narišite in prikažite obe sliki.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}

\PYG{n}{slika1} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros}\PYG{p}{(}\PYG{p}{(}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{)}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{uint8}\PYG{p}{)}

\PYG{n}{slika2} \PYG{o}{=} \PYG{n}{slika1}

\PYG{n}{slika2}\PYG{p}{[}\PYG{l+m+mi}{200}\PYG{p}{:}\PYG{l+m+mi}{300}\PYG{p}{,} \PYG{l+m+mi}{200}\PYG{p}{:}\PYG{l+m+mi}{300}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{255}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{slika1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{slika1}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{slika2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{slika2}\PYG{p}{)}

\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{destroyAllWindows}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Prikazali se bosta sliki, kot ju vidite na \sphinxstyleemphasis{sliki 8}.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{copy}.png}
\caption{Slika 8. Izvorna in “kopirana” slika.}\label{\detokenize{uvod_py_opencv:id9}}\end{figure}

\sphinxAtStartPar
Vidite lahko, da nekaj ni vredu; bel kvadratek naj bi narisali samo na \sphinxcode{\sphinxupquote{slika2}} ampak očitno smo ga tudi na \sphinxcode{\sphinxupquote{slika1}}.

\sphinxAtStartPar
Spremenite sedaj vrstico \sphinxstyleemphasis{6} v \sphinxcode{\sphinxupquote{slika2 = slika1.copy()}} in ponovno zaženite program. Sedaj mi morali videti pričakovano.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{deep_copy}.png}
\caption{Slika 8. Izvorna in \sphinxstylestrong{kopirana} slika.}\label{\detokenize{uvod_py_opencv:id10}}\end{figure}

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
Če za \sphinxstyleemphasis{kopiranje} uporabite samo \sphinxcode{\sphinxupquote{=}} slike v resnici ne kopirate, ampak še vedno prek druge spremenljivke dostopate do istega objekta/spomina (v \sphinxstyleemphasis{C++} bi temu rekli \sphinxstyleemphasis{kazalec} (angl: \sphinxstyleemphasis{pointer})). Če želite res \sphinxstyleemphasis{kopirati} sliko, morate skopirati tudi podatke/spomin (t.i. \sphinxstyleemphasis{deep copy}). To naredite z metodo \sphinxcode{\sphinxupquote{copy()}}.
\end{sphinxadmonition}


\chapter{Računalniška analiza interferogramov}
\label{\detokenize{obdelava_interferogramov:racunalniska-analiza-interferogramov}}\label{\detokenize{obdelava_interferogramov:obdelava-interferogramov}}\label{\detokenize{obdelava_interferogramov::doc}}
\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Če še nimate nameščenega \sphinxstyleemphasis{Python}\sphinxhyphen{}a in \sphinxstyleemphasis{OpenCV}\sphinxhyphen{}ja sledite navodilom na povezavi: \DUrole{xref,std,std-ref}{navodila\_python}.
\end{sphinxadmonition}

\sphinxAtStartPar
Na prejšnji vaji smo zajeli slike interferogramov, ki jih želimo sedaj računalniško obdelati. Ker bo skripta razmeroma dolga, jo bomo razdelili na več celic. Sledite navodilom, ki so zapisana v komentarjih.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Če ne uporabljate \sphinxstyleemphasis{Jupyter Notebooka}, boste morali vse celice zapisati v eno skripto.
\end{sphinxadmonition}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Besedilo se vedno nanaša na \sphinxstylestrong{sledečo celico}.
\end{sphinxadmonition}

\sphinxAtStartPar
V prvi celici bomo uvozili knjižnice, ki jih potrebujemo (\sphinxcode{\sphinxupquote{cv2}} in \sphinxcode{\sphinxupquote{numpy}}). Prav tako lahko definiramo spremenljivki π in 2π (ker se ime spremenljivke v Pythonu ne sme začeti s števil, jo bomo poimenovali π2).

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{cv2}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}

\PYG{c+c1}{\PYGZsh{}definiramo spremenjivko π}
\PYG{n}{π} \PYG{o}{=}
\PYG{c+c1}{\PYGZsh{}definiramo spremenjivko 2*π}
\PYG{n}{π2} \PYG{o}{=}
\end{sphinxVerbatim}

\sphinxAtStartPar
V naslednji celici bomo napisali funkcijo, ki bo prebrala in sprocesirala posamezno sliko. Definicijo funkcije moramo začeti z ukazom \sphinxcode{\sphinxupquote{def}}. \sphinxcode{\sphinxupquote{read\_and\_process\_image(filename, images, resize\_factor)}} pomeni, da je \sphinxstyleemphasis{read\_and\_process\_image} ime funkcije, \sphinxstyleemphasis{filename}, \sphinxstyleemphasis{images} in \sphinxstyleemphasis{resize\_factor} pa so argumenti, ki jih bomo morali podati.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{}funkcija za branje in procesiranje slik}
\PYG{c+c1}{\PYGZsh{}filename ... lokacija slike na disku}
\PYG{c+c1}{\PYGZsh{}images ... seznam, kamor shranimo slike}
\PYG{c+c1}{\PYGZsh{}resize\PYGZus{}factor ... faktor, za keterega spremenimo velikost slik}
\PYG{k}{def} \PYG{n+nf}{read\PYGZus{}and\PYGZus{}process\PYGZus{}image}\PYG{p}{(}\PYG{n}{filename}\PYG{p}{,} \PYG{n}{images}\PYG{p}{,} \PYG{n}{resize\PYGZus{}factor}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{}preberite sliko v barvah s funkcijo cv2.imread()}
    \PYG{n}{im} \PYG{o}{=}
    \PYG{c+c1}{\PYGZsh{}preberite dimenzije slike z metodo .shape}
    \PYG{n}{h}\PYG{p}{,} \PYG{n}{w} \PYG{o}{=}
    \PYG{c+c1}{\PYGZsh{}spremenite dimenzije slike s funkcijo cv2.resize()}
    \PYG{n}{im} \PYG{o}{=} \PYG{n}{cv2}\PYG{o}{.}\PYG{n}{resize}
    \PYG{c+c1}{\PYGZsh{}\PYGZdq{}razbite\PYGZdq{} sliko po posameznih kanalih; cv2.split()}

    \PYG{c+c1}{\PYGZsh{}filtrirajte sliko \PYGZhy{} razmislite, kateri kanal; cv2.GaussianBlur()}

    \PYG{c+c1}{\PYGZsh{}spremenite podatkovni tip vrednosti v float32 in ustrezno skalirajte}

    \PYG{c+c1}{\PYGZsh{}v seznam images dodajte končno sliko}
    \PYG{n}{images}\PYG{o}{.}\PYG{n}{append}
\end{sphinxVerbatim}

\sphinxAtStartPar
V tej celici podamo imena posameznih slik in jih zapišemo v \sphinxstyleemphasis{list}.

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
Spomnite se, kako navajamo poti na disku!
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{n}{filenames} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{c+c1}{\PYGZsh{}dodajte ime prve slike}

\PYG{c+c1}{\PYGZsh{}dodajte ime druge slike}

\PYG{c+c1}{\PYGZsh{}dodajte ime tretje slike}

\PYG{c+c1}{\PYGZsh{}dodajte ime četrte slike}

\end{sphinxVerbatim}

\sphinxAtStartPar
S sledčo celico bomo prebrali slike, jih dodali v \sphinxstyleemphasis{list} \sphinxcode{\sphinxupquote{images}} in prikazali.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{n}{images} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{c+c1}{\PYGZsh{} \PYGZdq{}za vsako ime v seznamu filenames\PYGZdq{}}

    \PYG{c+c1}{\PYGZsh{} uporabite funkcijo read\PYGZus{}and\PYGZus{}process\PYGZus{}image}

    
\PYG{c+c1}{\PYGZsh{} preberite dimenzije slike; h ... višina, w ... širina}
\PYG{n}{h}\PYG{p}{,} \PYG{n}{w} \PYG{o}{=}

\PYG{c+c1}{\PYGZsh{} pojdite čez slike in vsako prikažite}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,}  \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}  \PYG{p}{)}\PYG{p}{:}


\PYG{c+c1}{\PYGZsh{} spomnite se, kaj morate storiti po tem, ko slike prikažete}

\PYG{c+c1}{\PYGZsh{} zaprite vsa okna}

\end{sphinxVerbatim}

\sphinxAtStartPar
Sedaj bomo začeli z izračunom. V pomoč naj vam bodo \sphinxstyleemphasis{slajdi} s predavanj (\DUrole{xref,std,std-ref}{carre}). V tej celici želimo izračunati vrednost \({\alpha}(x,y)\). Če pogledate, kaj bomo morali storiti v naslednjem koraku, vidite, da je izračun \(arctan\) nekoliko nesmiselen, saj bomo morali potem v naslednjem koraku izračunati \(tan\), tako da namesto \({\alpha}(x,y)\) izračunajmo kar \(tan({\alpha}(x,y))\).

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{}odštejte vrednosti slike 2 od vrednosti slike 1}
\PYG{n}{I1m2} \PYG{o}{=}
\PYG{c+c1}{\PYGZsh{}odštejte vrednosti slike 3 od vrednosti slike 0}
\PYG{n}{I0m3} \PYG{o}{=}
\PYG{c+c1}{\PYGZsh{}izračunajte števec}
\PYG{n}{dividend} \PYG{o}{=}
\PYG{c+c1}{\PYGZsh{}izračunajte imenovalec}
\PYG{n}{divisor} \PYG{o}{=}

\PYG{c+c1}{\PYGZsh{}preverite, da imenovalec ni enak 0}
\PYG{n}{divisor}\PYG{p}{[}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{divisor}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.0000001}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mf}{0.0000001}

\PYG{c+c1}{\PYGZsh{}izračunajte tan\PYGZus{}alpha}
\PYG{n}{tan\PYGZus{}alpha} \PYG{o}{=}
\end{sphinxVerbatim}

\sphinxAtStartPar
Ko smo izračunali \(tan({\alpha}(x,y))\) nadaljujemo z izračunom \sphinxstyleemphasis{faze} (\({\Delta}{\Phi}(x,y)\)).

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Izračun \sphinxstyleemphasis{arkustangensa kvocienta dveh števil} je precej “zahtevna” operacija, saj imamo \sphinxstyleemphasis{6} možnih primerov. Zato ima praktično vsaka \sphinxstyleemphasis{matematična} knjižnica (ki da kaj nase) fukcijo \sphinxhref{https://en.wikipedia.org/wiki/Atan2}{atan2}. V \sphinxcode{\sphinxupquote{numpy}} jo najdemo kot \sphinxcode{\sphinxupquote{arctan2}}.
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} izračunajte sinusni del}
\PYG{n}{sine} \PYG{o}{=}
\PYG{c+c1}{\PYGZsh{} pomnožite sinusni del z tan\PYGZus{}alpha}

\PYG{c+c1}{\PYGZsh{} izračunajte cosinusni del}
\PYG{n}{cosine} \PYG{o}{=}

\PYG{c+c1}{\PYGZsh{} izračunajte fazo; namig (atan2)}
\PYG{n}{phase} \PYG{o}{=}

\PYG{c+c1}{\PYGZsh{} prikažite sliko}



\end{sphinxVerbatim}

\sphinxAtStartPar
Ker smo za izračun faze uporabili fukcijo \(arctan\) (v našem primeru v resnici \(arctan2\)) je \sphinxstyleemphasis{faza} omejena na inteval \([-\frac{\pi}{2}, \frac{\pi}{2} ]\) (ker smo uporabili \(arctan2\) smo v resnici omejeni na inteval \([-\pi, \pi ]\)). Kakorkoli, ker želimo dobiti zvezen potek \sphinxstyleemphasis{faze} moramo izvesti t.i. \sphinxstyleemphasis{razvijanje faze} (angl.: \sphinxhref{https://ccrma.stanford.edu/~jos/fp/Phase\_Unwrapping.html}{phase unwrapping}). Osnovna ideja (enostavnega algoritma za razvijanje faze) je, da se \sphinxstyleemphasis{pomikamo} po \sphinxstyleemphasis{fazi} in spremljamo, kje se pojavijo nezveznosti. Od tega mesta naprej prištejemo ali odštejemo \(2\pi\), odvisno od tega, v katero smer se pojavi nezveznost.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{}skopirajte vrednosti iz spremenljivke phase v spremenljivko phase\PYGZus{}unwrapped}
\PYG{n}{phase\PYGZus{}unwrapped} \PYG{o}{=}

\PYG{c+c1}{\PYGZsh{}\PYGZdq{}za vsako vrstico\PYGZdq{}}

    \PYG{c+c1}{\PYGZsh{}spremenljivko phase\PYGZus{}offset nastavite na vrednosti 0}

    \PYG{c+c1}{\PYGZsh{}\PYGZdq{}za vsak element v vrstici\PYGZdq{}}

        \PYG{c+c1}{\PYGZsh{}preberite prejšnjo vrednost v vrstici}
        \PYG{n}{p\PYGZus{}previous} \PYG{o}{=}
        \PYG{c+c1}{\PYGZsh{}preberite trenutno vrednost v vrstici}
        \PYG{n}{p\PYGZus{}current} \PYG{o}{=}
        
        \PYG{c+c1}{\PYGZsh{}če je \PYGZdq{}stopnica\PYGZdq{} od trenute do prejšnje vrednosti večja od π}

            \PYG{c+c1}{\PYGZsh{}vrednosti phase\PYGZus{}offset odštejte 2π}

        \PYG{c+c1}{\PYGZsh{}če je \PYGZdq{}stopnica\PYGZdq{} od trenutne do prejšnje manjša večja od \PYGZhy{}π}

            \PYG{c+c1}{\PYGZsh{}vrednosti phase\PYGZus{}offset prištejte 2π}

        
        \PYG{c+c1}{\PYGZsh{}vrednosti phase prištejete phase\PYGZus{}offset in jo zapišite v phase\PYGZus{}unwrapped}

\end{sphinxVerbatim}

\sphinxAtStartPar
Vizualizirajte rezultat.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} prikažite sliko razvite faze}


\PYG{c+c1}{\PYGZsh{} zaprite vsa okna}

\end{sphinxVerbatim}

\sphinxAtStartPar
Precej verjetno vidite naj podobnega srednjemu stolpcu na spodnji sliki. Želimo pa rezultat, kot je v zadnjem stolpcu.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{uw-1smer}.png}
\caption{Slika 1. Izvorne \sphinxstyleemphasis{faze} (prvi stolpec), \sphinxstyleemphasis{faza} kot bo razvita po našem algoritmu (sredinski stolpec) in rezultat, kot ga želimo (zadnji stolpec).}\label{\detokenize{obdelava_interferogramov:id1}}\end{figure}

\sphinxAtStartPar
Težava je v tem, da našo \sphinxstyleemphasis{sliko faze} razvijamo samo z leve proti desni, v primeru kot je zgoraj levo na \sphinxstyleemphasis{sliki 1} pa se do sredinskega polja pa nabere že kar nekaj \sphinxstyleemphasis{napake}.

\sphinxAtStartPar
Postopek razvijanja moramo zato ponoviti še enkrat, tokrat v navpični smeri.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} vrednost phase\PYGZus{}unwrapped skopirajte v phase\PYGZus{}unwrapped2}
\PYG{n}{phase\PYGZus{}unwrapped2} \PYG{o}{=}
\PYG{c+c1}{\PYGZsh{} izračunajte indeks sredinskega stolpca; pazite na tip!!}
\PYG{n}{u\PYGZus{}scan} \PYG{o}{=}
\PYG{c+c1}{\PYGZsh{} postavite vrednost phase\PYGZus{}offset na 0}
\PYG{n}{phase\PYGZus{}offset} \PYG{o}{=} \PYG{l+m+mi}{0}

\PYG{c+c1}{\PYGZsh{} \PYGZdq{}za vsako vrstico\PYGZdq{}}

    \PYG{c+c1}{\PYGZsh{} preberite vrednost prejšnjega elementa v sredinski vrstici}
    \PYG{n}{p\PYGZus{}previous} \PYG{o}{=}
    \PYG{c+c1}{\PYGZsh{} preberite vrednost trenutnega elementa v sredinski vrstici}
    \PYG{n}{p\PYGZus{}current} \PYG{o}{=}
    
    \PYG{c+c1}{\PYGZsh{} izračunajte razliko med trenutno in prejšnjo}
    \PYG{n}{diff\PYGZus{}c\PYGZus{}p} \PYG{o}{=}

    \PYG{c+c1}{\PYGZsh{}deljite z 2π}
    \PYG{n}{diff\PYGZus{}c\PYGZus{}p}
    \PYG{c+c1}{\PYGZsh{}zaikrožite}
    \PYG{n}{diff\PYGZus{}c\PYGZus{}p} \PYG{o}{=}
    \PYG{c+c1}{\PYGZsh{}pomnožite z 2π}
    \PYG{n}{diff\PYGZus{}c\PYGZus{}p}
    \PYG{c+c1}{\PYGZsh{}odštejte vrednost od phase\PYGZus{}offset}
    \PYG{n}{phase\PYGZus{}offset}
       
    \PYG{c+c1}{\PYGZsh{}celotni treutni vrstici prištejte vrednost phase\PYGZus{}offset}
    \PYG{n}{phase\PYGZus{}unwrapped2}\PYG{p}{[}\PYG{n}{v}\PYG{p}{,}\PYG{p}{:}\PYG{p}{]}
\end{sphinxVerbatim}

\sphinxAtStartPar
Vizualizirajte rezultat \sphinxstyleemphasis{faze}.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} prikažite končni rezultat}


\PYG{c+c1}{\PYGZsh{} zaprite vsa okna}

\end{sphinxVerbatim}

\sphinxAtStartPar
Če vas moti \sphinxstyleemphasis{šum} okoli faze (ljubkovalno imenovan tudi “šavje”), lahko preverite vidljivost signala na posameznem mestu in izrišete le točke, z visoko vidljivostjo.

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} prikažite končni rezultat z upoštevanjem ROI}

\PYG{c+c1}{\PYGZsh{} izračunajte standardno deviacijo med slikami}
\PYG{n}{STD} \PYG{o}{=} 
\PYG{c+c1}{\PYGZsh{} preverite, kje je STD večji od 0.01}
\PYG{n}{ROI} \PYG{o}{=} 
\PYG{c+c1}{\PYGZsh{} skopirajte razvito sliko v phsUW }

\PYG{c+c1}{\PYGZsh{} v phsUW nastavite vrednosti, kjer je ROI enak Fasle na NaN}


\PYG{c+c1}{\PYGZsh{} izrišite sliko}
\PYG{n}{imshow}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{STD}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{phsUW}\PYG{p}{)}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{waitKey}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} zaprite vsa okna}
\PYG{n}{cv2}\PYG{o}{.}\PYG{n}{destroyAllWindows}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}


\chapter{Razvoj programske opreme laserskega 3D merilnika}
\label{\detokenize{laserskiprofilomer:razvoj-programske-opreme-laserskega-3d-merilnika}}\label{\detokenize{laserskiprofilomer:laserskiprofilomer}}\label{\detokenize{laserskiprofilomer::doc}}
\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Če še nimate nameščenega Pythona in OpenCVja sledite navodilom na povezavi: \DUrole{xref,std,std-ref}{navodila\_python}.
\end{sphinxadmonition}


\section{Uvod}
\label{\detokenize{laserskiprofilomer:uvod}}
\sphinxAtStartPar
Cilj vaje je praktično spoznati osnove laserske triangulacije in izdelati programsko opremo za enostaven linearni laserski profilomer. Sistem in programska oprema za zajem sekvence merilnih slik sta predhodno pripravljena, vaša naloga pa je, da napišete program, ki bo iz te sekvence slik rekonstruiral obliko merjene površine.


\section{Oprema}
\label{\detokenize{laserskiprofilomer:oprema}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Linearna koračna miza

\item {} 
\sphinxAtStartPar
Krmilnik koračne mize

\item {} 
\sphinxAtStartPar
Linijski laserski projektor

\item {} 
\sphinxAtStartPar
Kamera

\end{itemize}


\section{Potek vaje}
\label{\detokenize{laserskiprofilomer:potek-vaje}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Ogled sistema (na koračno mizo sta pod kotom pritrjena kamera in laserski projektor, ogledamo si sliko na kameri pri različnih nastavitvah kamere in različnih odbojnostih).

\item {} 
\sphinxAtStartPar
Zajem sekvence merilnih slik.

\item {} 
\sphinxAtStartPar
Izdelava programa za transformacijo (\sphinxhref{https://www.python.org/}{Python}  \& \sphinxhref{https://opencv.org/}{OpenCV} ).

\item {} 
\sphinxAtStartPar
Prikaz izmerkov; preverili bomo ujemanje rekonstruirane površine z referenčno.

\end{itemize}


\section{Osnovni pojmi}
\label{\detokenize{laserskiprofilomer:osnovni-pojmi}}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{triangulacija2}.png}
\caption{Slika 1. Shema triangulacije z označenimi merami.}\label{\detokenize{laserskiprofilomer:id1}}\end{figure}

\sphinxAtStartPar
Skica merilnega sistema je prikazana na \sphinxstyleemphasis{sliki 1}. Projektor je postavljen na mestu \sphinxstyleemphasis{P} in projicira svetlobno
ravnino proti merjeni površini. Kamera je postavljena na mestu, označenem s \sphinxstyleemphasis{C}. \sphinxstyleemphasis{Koordinatni sistem} (\sphinxstyleemphasis{k.
s.}) merilnika (\sphinxstyleemphasis{KS}$_{\text{merilnika}}$) je postavljen na presečišče laserske ravnine in pravokotne projekcije središčaleče na lasersko ravnino. Model preslikave temelji na uporabi perspektivne projekcije z enostavno
geometrijo kamere z luknjico (\sphinxstyleemphasis{camera obscura}, angl. \sphinxstyleemphasis{pinhole camera}). Senzor je postavljen na razdalji
\sphinxstyleemphasis{f} od koordinatnega izhodišča. Optična os objektiva prebada ravnino kamere na koordinati (\sphinxstyleemphasis{c}$_{\text{U}}$, \sphinxstyleemphasis{c}$_{\text{V}}$, \sphinxstyleemphasis{angl. principal point})
merjeno glede na zgornji levi rob senzorja (standard pri navajanju položaja točke pri senzorjih, zaslonih,
slikah etc.). Projektor je glede na koordinatno izhodišče premaknjen le v \sphinxstyleemphasis{X} smeri za razdaljo \sphinxstyleemphasis{P}$_{\text{X}}$ in
projicira svetlobno ravnino pod kotom \sphinxstyleemphasis{α} glede na optično os objektiva kamere.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.2]{{merilna_slikaT}.jpg}
\caption{Slika 2. Ena iz množice slik. Poiskati moramo lokacijo sentra presečne krivulje v k.s. kamere.}\label{\detokenize{laserskiprofilomer:id2}}\end{figure}

\sphinxAtStartPar
Na \sphinxstyleemphasis{sliki 2} je prikazana slika, kot jo vidi kamera. Vidimo lahko, da je merjena površina v osrednjem delu
nekoliko dvignjena glede na spodnji in zgornji del. Označena sta \sphinxstyleemphasis{k. s.} slike (\sphinxstyleemphasis{KS}$_{\text{slike}}$) in \sphinxstyleemphasis{k. s.} kamere
(\sphinxstyleemphasis{KS}$_{\text{kamere}}$), ki leži na mestu preboda optične osi. Označeni sta tudi smer \sphinxstyleemphasis{u} in \sphinxstyleemphasis{v}.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
\sphinxstyleemphasis{Slika 2} je transponirana, kar pomeni, da sta smeri \sphinxstyleemphasis{v} in \sphinxstyleemphasis{u} zamenjani. Sliko transponiramo zato, ker se je laže premikati po vrstici, kot po stolpcu.
\end{sphinxadmonition}

\sphinxAtStartPar
Merilnik se med merjenjem translatorno premika v \sphinxstyleemphasis{X} smeri in ob tem zajel \sphinxstyleemphasis{N} slik. Glede na to, da sta
hitrosti premikanja in zajemanja slik konstantni, lahko določimo premik merilnika med dvema
zaporednima slikama kot:
\begin{equation*}
\begin{split}x_{\text{STEP}} = \frac{ x_{\text{MOVE}}}{N}\end{split}
\end{equation*}
\sphinxAtStartPar
kjer sta \sphinxstyleemphasis{x}$_{\text{MOVE}}$ celoten premik med merjenjem in \sphinxstyleemphasis{x}$_{\text{STEP}}$ premik med dvema zaporednima slikama. Z vsake slike pa lahko razberemo obliko osvetljenega profila površine in tako dobimo površino kot množico zaporednih profilov.
Za izračun koordinate posamezne točke profila v \sphinxstyleemphasis{k. s.} merilnika, moramo najprej poiskati koordinate
posamezne točke profila v \sphinxstyleemphasis{k. s.} kamere (na senzorju) na posamezni sliki. V praksi to pomeni, da moramo
v vsaki vrstici (za vsak \sphinxstyleemphasis{v}) poiskati center presečne krivulje v smeri \sphinxstyleemphasis{u} (koordinato \sphinxstyleemphasis{u}) (glejte \sphinxstyleemphasis{sliko 2}).


\section{Glavni program}
\label{\detokenize{laserskiprofilomer:glavni-program}}
\sphinxAtStartPar
V tem delu programa bomo spisali ogrodje programa. Njegova glavna naloga je, da prebere vsako sliko
in s pomočjo funkcije za iskanje presečne krivulje (ki jo bomo napisali ločeno) na vsaki sliki najde
lokacijo maksimumov intenzitete.
Uporabljali bomo programski jezik \sphinxstyleemphasis{Python} v kombinaciji s knjižnico \sphinxstyleemphasis{OpenCV}. V pomoč pri izdelavi
programa naj vam bo diagram poteka (glejte \DUrole{xref,std,std-ref}{priloga1}). Na predvideno mesto (osnova je že
pripravljena) napišete jedro programa. Rekonstrukcijo površine boste naredili posebej, kot funkcijo na
vnaprej pripravljenem mestu. Bodite pozorni, kako se naslavlja elemente v matriki (primer: \(B(i,j)\)  … je \sphinxstyleemphasis{i}
koordinata vrstice ali stolpca ?).

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.13]{{zapisovanje_profilov}.jpg}
\caption{Slika 3. Skica povezava funkcije \sphinxcode{\sphinxupquote{DetectLine()}} in matrike profilov.}\label{\detokenize{laserskiprofilomer:id3}}\end{figure}

\sphinxAtStartPar
Zaznane profile na sliki boste zapisali v matriko profilov. Logiko matrike profilov lahko vidite na sliki 3.
Dolžina vrstic mora biti enaka dimenziji slike v v smeri (npr. če so slike visoke 640 slikovnih elementov
(s. e.), mora vsaka vrstica sprejeti po 640 elementov), število vrstic pa mora biti enako številu zajetih
slik \sphinxstyleemphasis{N} (npr. če smo zajeli 300 slik, torej mora imeti matrika profilov 300 vrstic). Na vsaki sliki bomo tako
v vsaki vrstici poiskali položaj presečne krivulje v smeri \sphinxstyleemphasis{u}. Npr. če je na 17. sliki v 37. vrstici položaj
presečne krivulje na koordinati 103, bomo zapisali \sphinxcode{\sphinxupquote{profiles(17, 37) = 103}}.Pri pisanju programa naj vam bosta v pomoč Priloga 1 in template programa. Sledite naslednjemu
postopku:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Na začetku programa najavite in nastavite globalne spremenljivke, ki jih bomo potrebovali tekom celotnega programa (npr. mapa, kjer se nahajajo datoteke, število merilnih slik, alociramo prostor za profile).

\item {} 
\sphinxAtStartPar
Začnite zanko.

\item {} 
\sphinxAtStartPar
Generirajte ime slike in jo naložite v spomin. Namig: Uporabite \sphinxcode{\sphinxupquote{cv2.imread()}}

\item {} 
\sphinxAtStartPar
Sliko transponirajte (to storite izključno zaradi lažje obdelave, saj se je laže premikati po vrstici kot po stolpcu) in jo pretvorite v primeren format (32 bitna števila s plavajočo vejico). Namig: \sphinxcode{\sphinxupquote{cv2.transpose(...)}}.

\item {} 
\sphinxAtStartPar
Na tem mestu kličite funkcijo \sphinxcode{\sphinxupquote{detect\_profile(...)}}. Kot drugi parameter podajte kazalec na vrstico matrike profilov, ki ima isti indeks kot trenutna slika, ki jo obdelujemo (glejte \sphinxstyleemphasis{sliko 3}).

\item {} 
\sphinxAtStartPar
Zaključite zanko.

\item {} 
\sphinxAtStartPar
Rekonstruirajte površino.

\end{enumerate}


\section{Funkcija \sphinxstyleliteralintitle{\sphinxupquote{detect\_profile(...)}}}
\label{\detokenize{laserskiprofilomer:funkcija-detect-profile}}
\sphinxAtStartPar
Uporabite predlogo \sphinxcode{\sphinxupquote{detect\_profile(image, profile, filter\_size)}}.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Filtrirajte sliko z \sphinxstyleemphasis{Gaussovim filtrom}. Širina filtrirnega okna mora biti širša od presečne krivulje na sliki! Namig: \sphinxcode{\sphinxupquote{cv2.GaussianBlur(...)}}

\item {} 
\sphinxAtStartPar
Izračunajte odvod slike. Namig: \sphinxcode{\sphinxupquote{cv2.Sobel(...)}}

\item {} 
\sphinxAtStartPar
Poiščite lokacijo prevoja na presečni krivulji.
\begin{enumerate}
\sphinxsetlistlabels{\alph}{enumii}{enumiii}{}{.}%
\item {} 
\sphinxAtStartPar
Prevojev na sliki je lahko več, a uporabite predpostavko, da je intenziteta na mestu prevoja presečne krivulje večja od prevojev na drugih mestih. Namig: preverite, ali je intenziteta ne tem mestu večja, kot na predhodno zaznanem mestu prevoja.

\item {} 
\sphinxAtStartPar
Poiščite lokacijo prevoja. Uporabite v prejšnjem koraku izračunani odvod intenzitete. Namig: Iščemo samo maksimume; razmislite, katere prehode torej iščemo.

\item {} 
\sphinxAtStartPar
Napredno: Poiščite lokacijo središča presečne krivulje (prevoja) s podtočkovno ločljivostjo. Namig: Glejte spodnjo sliko (slika 4).

\end{enumerate}

\end{enumerate}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.08]{{subpixel_accuracy}.jpg}
\caption{Slika 4. Skica za izračun podtočkovne ločljivosti.}\label{\detokenize{laserskiprofilomer:id4}}\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{3}
\item {} 
\sphinxAtStartPar
Rezultat morala biti vektor, ki je enako dolg kot slika v smeri \sphinxstyleemphasis{v}.

\end{enumerate}


\section{Rekonstrukcija površine}
\label{\detokenize{laserskiprofilomer:rekonstrukcija-povrsine}}
\sphinxAtStartPar
Normalizirane lokacije presečne krivulje izračunamo po spodnjih enačbah:
\begin{equation*}
\begin{split}U_N = \frac{U_d \cdot du}{f} =  \frac{(U - c_u) \cdot du}{f}\end{split}
\end{equation*}
\sphinxAtStartPar
in
\begin{equation*}
\begin{split}V_N = \frac{V_d \cdot dv}{f} =  \frac{(V - c_v) \cdot dv}{f}\end{split}
\end{equation*}
\sphinxAtStartPar
kjer sta \sphinxstyleemphasis{U}$_{\text{N}}$ in \sphinxstyleemphasis{V}$_{\text{N}}$ normalizirani koordinati (smerna vektorja žarka, ki izhaja iz senzorja proti merjeni površini), \sphinxstyleemphasis{c}$_{\text{u}}$ in \sphinxstyleemphasis{c}$_{\text{v}}$ lokaciji centra slike v smeri \sphinxstyleemphasis{u} in \sphinxstyleemphasis{v}, \sphinxstyleemphasis{du} in \sphinxstyleemphasis{dv} velikosti senzorskega elementa v \sphinxstyleemphasis{u} in \sphinxstyleemphasis{v} smeri, ter f goriščna razdalja objektiva kamere.
Oddaljenost merjene točke v koordinatnem sistemu merilnika v \sphinxstyleemphasis{z} smeri \sphinxstyleemphasis{z}$_{\text{M}}$ izračunamo kot:
\begin{equation*}
\begin{split}z_M = \frac{P_X}{\tan(\alpha - \arctan(\frac{V_N}{f}))}\end{split}
\end{equation*}
\sphinxAtStartPar
kjer je α triangulacijski kot in \sphinxstyleemphasis{P}$_{\text{X}}$ razdalja med kamero in projektorjem.
Koordinato točke \sphinxstyleemphasis{x}$_{\text{M}}$ izračunamo kot:
\begin{equation*}
\begin{split}y_M = z_M \cdot U_N\end{split}
\end{equation*}
\sphinxAtStartPar
Razmislite, kako izračunamo koordinato \sphinxstyleemphasis{x}$_{\text{M}}$ . (Namig: izkoristite for zanko, kakšen je korak med
mestoma zajema dveh zaporednih slik?)


\section{Vizualizacija rezultatov}
\label{\detokenize{laserskiprofilomer:vizualizacija-rezultatov}}
\sphinxAtStartPar
Za vizualizacijo rezultatov uporabite osnovno funkcionalnost Pythona.


\section{Priloge}
\label{\detokenize{laserskiprofilomer:priloge}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{priloga1}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{priloga2}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{priloga3}

\end{itemize}


\chapter{Umeritev laserskega 3D merilnika}
\label{\detokenize{kalibracija:umeritev-laserskega-3d-merilnika}}\label{\detokenize{kalibracija:kalibracija}}\label{\detokenize{kalibracija::doc}}

\section{Uvod}
\label{\detokenize{kalibracija:uvod}}
\sphinxAtStartPar
Cilj vaje je spoznati osnovne pristope in praktično izvesti umeritev laserskega rotacijskega merilnika.


\section{Oprema}
\label{\detokenize{kalibracija:oprema}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Laserski rotacijski 3D merilnik \textendash{} Merkur.

\item {} 
\sphinxAtStartPar
Koračna miza.

\item {} 
\sphinxAtStartPar
Referenčna površina.

\item {} 
\sphinxAtStartPar
Programska oprema za izračun optimalnih transformacijskih parametrov.

\end{itemize}


\section{Potek vaje}
\label{\detokenize{kalibracija:potek-vaje}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Ogled sistema.

\item {} 
\sphinxAtStartPar
Zajem sekvence umeritvenih meritev.

\item {} 
\sphinxAtStartPar
Izvedba umeritve.

\item {} 
\sphinxAtStartPar
Primerjava površin pred in po umeritvi.

\end{itemize}


\section{Predstavitev parametrov rekonstrukcije}
\label{\detokenize{kalibracija:predstavitev-parametrov-rekonstrukcije}}\begin{itemize}
\item {} \begin{description}
\item[{Notranji parametri:}] \leavevmode\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{f}              goriščna razdalja leče  {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{cu}             lokacija presečišča optične osi leče in senzorske ravnine v U smeri                                                             {[}št. senzorskih elementov{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{cv}             lokacija presečišča optične osi leče in senzorske ravnine v V smeri                                                             {[}št. senzorskih elementov{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{alfa}   triangulacijski kot                                     {[}°{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{beta}   kot nagiba senzorskega elementa glede na pravokotnico optične osi kamere; pozitivna smer je proti Scheimpflugovi korekciji                      {[}°{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{psi}            rotacija kamere okrog lastne optične osi                {[}°{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Py}             lega projektorja glede na kamerin k. s. v Y smeri       {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Pz}             lega projektorja glede na kamerin k. s. v Z smeri       {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{du}             dimenzija senzorskega elementa v U smeri                {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{dv}             dimenzija senzorskega elementa v V smeri                {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{k0}             parameter distorzije kamere

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{k1}             parameter distorzije kamere

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{k2}             parameter distorzije kamere

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{k3}             parameter distorzije kamere

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Ry}             lega k. s. projektorja glede na vrtičše merilnika (k. s. modula) v Y smeri      {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Rz}             lega k. s. projektorja glede na vrtičše merilnika (k. s. modula) v Z smeri      {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Ko\_rot} korekcija zasuka projektorja okrog njegove osi (odstopanje od vzporednosti s kamero)                                                            {[}°{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{domega} kotni zasuk mizice pri nem koraku motorja               {[}°{]}

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Zunanji parametri}] \leavevmode\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{TX}             translacija v X smeri   {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{TY}             translacija v Y smeri   {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{TZ}             translacija v Z smeri   {[}mm{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{RX}             rotacija okrog X osi    {[}°{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{RY}             rotacija okrog Y osi    {[}°{]}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{RZ}             rotacija okrog Z osi    {[}°{]}

\end{itemize}

\end{description}

\end{itemize}


\section{Nastavitev programa}
\label{\detokenize{kalibracija:nastavitev-programa}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Z uporabo merilnega traku, kotomera in priložene dokumentacije ocenite začetne približke transformacijskih parametrov. Parametri, ki jih je potrebno oceniti so:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{cu};    kot začetni približek vzemite polovično število slikovnih elementov v U smeri

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{cv};    kot začetni približek vzemite polovično število slikovnih elementov v V smeri

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{alfa}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Py}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Pz}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{du}; poglejte v dokumentacijo kamere

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{dv}; poglejte v dokumentacijo kamere

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{domega}

\end{itemize}

\item {} 
\sphinxAtStartPar
Ostale parametre bomo določili s pomočjo umeritvenega programa.

\item {} 
\sphinxAtStartPar
Ko ste ocenili začetne približke, odprite LabView program calibration for rotational profilomer (ver 2\_0 for prf). Spreminjate lahko naslednje nastavitve:
\begin{enumerate}
\sphinxsetlistlabels{\alph}{enumii}{enumiii}{}{.}%
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Detection parameters}:
\begin{enumerate}
\sphinxsetlistlabels{\roman}{enumiii}{enumiv}{}{.}%
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{NofSurf} … število odprtih umeritvenih meritev

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{first srf} … indeks prve meritve

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{SurfIncr} … kolikšen je inkrement med dvema meritvama (1 … zaporedne meritve, 2 … vsaka druga itd …); če povečujete, je potrebno ustrezno povečati DZ (pomik med dvema zaporednima odprtima meritvam)

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{first N prf.}, \sphinxstylestrong{last N prf.}, \sphinxstylestrong{prf. start}, \sphinxstylestrong{prf. end} … parametri, s katerimi »obrežemo meritev«, uporabite v primeru šuma o robovih meritve

\end{enumerate}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{TRP \& opt out}

\end{enumerate}

\item {} 
\sphinxAtStartPar
Ostale parametre spreminjaje le v nujnih primerih in po posvetovanju z asistentom.

\end{enumerate}


\section{Zagon optimizacije}
\label{\detokenize{kalibracija:zagon-optimizacije}}
\sphinxAtStartPar
Predlagamo, da za umerjanje uporabite naslednji »algoritem«:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Ob nastavljenih začetnih približkih odprite eno samo meritev in jo vizualno primerjaje z idealno meritvijo (\sphinxstylestrong{gumb draw} ideal). Če so odstopanja res velika (predvsem \sphinxstylestrong{merilo}), preverite začetne približke.

\item {} 
\sphinxAtStartPar
Če meritev \sphinxstyleemphasis{ni vsaj približno} v merilu (na merilo v Y smeri vpliva predvsem parameter \sphinxstylestrong{domega}), poskusite ročno spreminjati kot triangulacije (\sphinxstylestrong{alfa}), kot med dvema profiloma (\sphinxstylestrong{domega}) in razdaljo med kamero in projektorjem (\sphinxstylestrong{Py}) ter goriščno razdaljo leče (\sphinxstylestrong{f}).

\item {} 
\sphinxAtStartPar
Zaženite optimizacijo zunanjih parametrov (\sphinxstylestrong{TX}, \sphinxstylestrong{TY}, \sphinxstylestrong{TZ}, \sphinxstylestrong{RX}, \sphinxstylestrong{RY}, \sphinxstylestrong{RZ}), da poravnate površino z referenčno (kanali morajo sovpadati).

\item {} 
\sphinxAtStartPar
Ko standardna deviacija odstopkov med izmerjeno in referenčno površino pade pod 3\sphinxhyphen{}4 mm, lahko (za kratek čas) poskusite vklopiti tudi optimizacijo kota triangulacije (\sphinxstylestrong{alfa}), goriščne razdalje objektiva (\sphinxstylestrong{f}), kota med dvema profiloma (\sphinxstylestrong{domega}), sredine slike (\sphinxstylestrong{cu}, \sphinxstylestrong{cv}) in razdalje med kamero in projektorjem (\sphinxstylestrong{Py}). Rezultat vseskozi vizualno nadzorujte. Če se meritev povsem »podre«, optimizacijo ustavite.

\item {} 
\sphinxAtStartPar
Če se oblika površine ni povsem »podrla«, odprite dodatne meritve in preverite, kako vplivajo na standardno deviacijo odstopkov (SDO). Če je oblika vseh rekonstruiranih površin približno pravilna, SDO pa je drastično narasla, preverite, ali sta \sphinxstylestrong{SurfInc} in \sphinxstylestrong{DZ} pravilna.

\item {} 
\sphinxAtStartPar
Če imate občutek, da umeritev konvergira v pravo smer (smo v globalnem minimum),vklopite umeritev vseh parametrov, se udobno namestite in čakajte … Ko pade standardna deviacija pod približno 1,3 mm ste (skoraj) zagotovo v globalnem minimumu in \sphinxstylestrong{lahko optimirate vse parametre}.

\end{enumerate}

\sphinxAtStartPar
Če se vam meritev povsem podre, preverite, kateri parameter je ušel in se vrnite korak ali dva nazaj.


\section{Zabeležite rezultate}
\label{\detokenize{kalibracija:zabelezite-rezultate}}
\sphinxAtStartPar
Končni rezultat, ki ga morate predstaviti v poročilu, je SDO med referenčno in izmerjeno površino in dobljeni transformacijski parametri. Naredite tudi »screen shot« polja odstopkov (gumb \sphinxstylestrong{draw diff}) in ga priložite poročilu.
Primerjajte začetno in končno referenčno površino, ter preverite, kako parametri, ki so težko izmerljivi/ocenljivi vplivajo na obliko rekonstruirane površine in SDO.


\chapter{Obdelava 3D meritev}
\label{\detokenize{obdelava_3D_meritev:obdelava-3d-meritev}}\label{\detokenize{obdelava_3D_meritev:id1}}\label{\detokenize{obdelava_3D_meritev::doc}}

\section{Uvod}
\label{\detokenize{obdelava_3D_meritev:uvod}}
\sphinxAtStartPar
Pri tej nalogi boste z rotacijskim laserskim profilomerom, ki smo ga umerili na prejšnji vaji, izmerili serijo meritev istega objekta z več različnih pogledov. Meritve boste nato obdelali, sestavili in poravnali v programskem okolju Geomagic Studio (GM).


\section{Izmerite merjeni objekt iz več pogledov}
\label{\detokenize{obdelava_3D_meritev:izmerite-merjeni-objekt-iz-vec-pogledov}}
\sphinxAtStartPar
Merjeni objekt postavite pred merilnik na primerno oddaljenost in ga izmerite. Pri tem poskrbite, da se med zajemanjem posamezne meritve merilnik in merjeni objekt ne bosta premikala. V nasprotnem primeru lahko pride do nenatančnih meritev, ki jih ne bo mogoče poravnati. Zato bodite med merjenjem \sphinxstylestrong{pazljivi in natančni}.
Objekt izmerite iz toliko pogledov, da bo izmerjena celotna površina. Pazite, da bo med dvema sosednjima meritvama dovolj prekrivanja (priporočamo približno 30 \% prekrivanje) in da je na območju prekrivanja kakšna značilka (angl.: \sphinxstyleemphasis{feature}).

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.4]{{prekrivanje}.jpg}
\caption{Slika 1. Prenizka stopnja prekrivanja (levo), primerna stopnja prekrivanja (desno).}\label{\detokenize{obdelava_3D_meritev:id2}}\end{figure}


\section{Uvoz množice meritev v GM}
\label{\detokenize{obdelava_3D_meritev:uvoz-mnozice-meritev-v-gm}}
\sphinxAtStartPar
V GM bomo meritve uvozili v obliki standardnega trikotniškega formata \sphinxstyleemphasis{.VRML} (včasih imenovan tudi \sphinxstyleemphasis{.wrl}) s funkcijo \sphinxstyleemphasis{Import} (\sphinxstylestrong{File \(\rightarrow\) Import}).

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Naslednjo meritev izberete s tipko \sphinxstyleemphasis{F3}, prejšnjo s tipko \sphinxstyleemphasis{F4}, vse meritve izberete s tipko \sphinxstyleemphasis{F5}, vse, razen izbranih meritev pa skrijete s tipko \sphinxstyleemphasis{F2}.
\end{sphinxadmonition}

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
Zaradi velike količine podatkov, ki jih GM obdela ob vsakem klicu funkcije, funkcija \sphinxstyleemphasis{UNDO} deluje le izjemoma, zato \sphinxstylestrong{vmesne rezultate shranjujte sproti pod različnimi imeni}.
\end{sphinxadmonition}


\section{Priprava meritev}
\label{\detokenize{obdelava_3D_meritev:priprava-meritev}}
\sphinxAtStartPar
Precej verjetno je, da je merilnik poleg samega merjenega objekta izmeril tudi del okolice. Ta ni predmet naloge in bo le oteževala poravnavo. Posamezno meritev zato najprej »očistite«; izbrišite vse površine, ki ne pripadajo merjenem objektu.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Izberite vsaj eno točko na površinah, ki jih želite obdržati in izberite \sphinxstyleemphasis{Bounded Components} (\sphinxstylestrong{Select\(\rightarrow\)Select Components\(\rightarrow\)Bounded Components}), nato pa desni klik in \sphinxstyleemphasis{Reverse Selection} (\sphinxstylestrong{RMC\(\rightarrow\)Reverse Selection}). Tako boste izbrali vse površine, ki niso sklenjene z na začetku izbranimi točkami.
\end{sphinxadmonition}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.4]{{izvorna_vs_ociscena}.jpg}
\caption{Slika 2. Izvorna meritev (levo) in “očiščena” meritev (desno).}\label{\detokenize{obdelava_3D_meritev:id3}}\end{figure}


\section{Ročna poravnava (sestavljanje)}
\label{\detokenize{obdelava_3D_meritev:rocna-poravnava-sestavljanje}}
\sphinxAtStartPar
Meritve najprej poravnajte ročno. Pri tem koraku ne izgubljajte preveč časa s pretirano natančno poravnavo, saj boste to storili v naslednjem koraku z uporabo temu namenjenih funkcij. Dovolj je, da so meritve vsaj približno pravilno medsebojno orientirane.
Najprej izberite vse meritve, ki jih želite poravnati in izberite \sphinxstyleemphasis{Manual Registration} (\sphinxstylestrong{Alignment\(\rightarrow\)Manual Registration}). Na levi se odpre pogovorno okno, kjer izberete način poravnave (\sphinxstylestrong{A}), površino, ki bo fiksna (\sphinxstylestrong{B}) in površino, ki jo bomo poravnali na fiksno (\sphinxstylestrong{C}). Izbirate lahko med poravnavo z določitvijo ene soležne točke (\sphinxstyleemphasis{1RP}) ali več kot treh soležnih točk (\sphinxstyleemphasis{NPR}). Način \sphinxstyleemphasis{1RP} je uporaben predvsem v primerih, ko ne najdete veliko soležnih točk, hkrati pa je prekrivanje razmeroma veliko. Pred uporabo tega načina je priporočljivo, da obe površini orientirate v približno enak pogled. Način \sphinxstyleemphasis{NPR} uporabljate kadar lahko najdete množico soležnih točk, želite hitreje zlagati površine ali poravnava z \sphinxstyleemphasis{1PR} ne uspe. Ni potrebe, da bi določili \sphinxstyleemphasis{N} povsem istih točk; manjše razlike v mestu klika nimajo vpliva na algoritem, saj se nato običajno naknadno sproži še funkcija \sphinxstyleemphasis{Register} (\sphinxstylestrong{D}), ki odpravi manjše odstopke med poravnanima površinama. Če ste z rezultatom zadovoljni pritisnite gumb \sphinxstyleemphasis{Next} (\sphinxstylestrong{E}) in na poravnani površini poravnajte naslednjo površino. Tako (na grobo) zložite skupaj vse meritve. Pomembno je, da ob tem vizualno preverjate, kako so površine medsebojno orientirane, saj lahko kakšna površina »uide«.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{UI2}.jpg}
\caption{Slika 3. Slika uporabniškega vmesnika z označenimi osnovnimi gumbi, ki jih boste potrebovali.}\label{\detokenize{obdelava_3D_meritev:id4}}\end{figure}


\section{Globalna poravnava}
\label{\detokenize{obdelava_3D_meritev:globalna-poravnava}}
\sphinxAtStartPar
Ko ste »na grobo« poravnali oz. sestavili vse površine zaženite funkcijo \sphinxstyleemphasis{Global Registration} (\sphinxstylestrong{Alignment\(\rightarrow\)Global Registration}). Tako bo algoritem »na fino« poravnal vse površine med seboj. Rezultat vizualno preverite, predvsem na mestih, kjer bi bila morebitna neuspešna poravnava še posebej očitna.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.4]{{GR-pred-po}.jpg}
\caption{Slika 4. Meritvi po ročni on pred globalno poravnavo (leva), meritvi po globalni poravnavi (desno).}\label{\detokenize{obdelava_3D_meritev:id5}}\end{figure}


\section{Končna obdelava}
\label{\detokenize{obdelava_3D_meritev:koncna-obdelava}}
\sphinxAtStartPar
Ko so vse površine poravnane tudi »na fino« jih združite v eno samo površino. To storite z ukazom \sphinxstyleemphasis{Merge} (\sphinxstylestrong{Polygons\(\rightarrow\)Merge}). Po želji nastavite lokalno in globalno filtriranje, želeno število točk, dodatno globalno poravnavo ipd…
Na mestih, kjer se posamezne meritve prekrivajo ali je prisotnega nekoliko več šuma pogosto pride do nepravilnega kombiniranja meritev, kar ima za posledico nepravilno obliko površin. GM nam ponuja vrsto orodij, s pomočjo katerih lahko te nepravilnosti odpravimo. V tej fazi se lotite tudi morebitnega odstranjevanja reliefnih markerjev (če ste jih uporabljali). Prva metoda je, da reliefne markerje iz površin enostavno izrežemo, druga pa, da uporabite funkcijo \sphinxstyleemphasis{Defeature} (\sphinxstylestrong{Polygons\(\rightarrow\)Defeature}). Ker je uporaba markerjev potrebna le na površinah, ki nimajo izrazitih geometrijskih značilnosti, se interpolacijske metode zapolnjevanja lukenj izkažejo za precej uspešne in na površini ni vidnih ostankov markerja. Če so ti prisotni, je bilo izbrano mesto izbrano neposrečeno.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.4]{{final}.jpg}
\caption{Slika 5. Poravnane meritve (levo), združene meritve (sredina), končni rezultat merjenja z zapolnjenimi luknjami in zglajenimi vidnimi šivi (desno).}\label{\detokenize{obdelava_3D_meritev:id6}}\end{figure}


\chapter{Vlakenski senzorji}
\label{\detokenize{vlakenski_senzorji:vlakenski-senzorji}}\label{\detokenize{vlakenski_senzorji:id1}}\label{\detokenize{vlakenski_senzorji::doc}}

\section{Uvod}
\label{\detokenize{vlakenski_senzorji:uvod}}
\sphinxAtStartPar
Na vaji boste spoznali dva vlakenska senzorja: \sphinxstyleemphasis{vlakenski senzor pomika} in \sphinxstyleemphasis{vlakenski fluorescentni termometer}. Spoznali boste osnovne principe delovanja, področja uporabe tovrstnih senzorjev in izvedli umeritev obeh senzorjev.


\section{Vlakenski senzor pomika}
\label{\detokenize{vlakenski_senzorji:vlakenski-senzor-pomika}}
\sphinxAtStartPar
Principe delovanja optičnih vlaken ste že spoznali. Osnovni pojav je totalni odboj, ki se vrši na meji med jedrom in plaščem vlakna, kadar je vpadni kot žarka glede na normalo meje dovolj velik; večji od mejnega kota \({\Theta_C}\).

\sphinxAtStartPar
Če je vlakno ravno, moramo tako le zagotoviti, da žarek v vlakno uvedemo pod kotom, ki je manjši od \({\Theta_{NA}}\) in vsa uvedena svetloba bo izšla tudi iz vlakna. Mejni vstopni kot \({\Theta_{NA}}\) izračunamo kot:
\begin{equation*}
\begin{split}NA = sin \theta_{NA} = \frac{1}{n_0} \sqrt{n_J ² - n_P ²}\end{split}
\end{equation*}
\sphinxAtStartPar
kjer je \sphinxstyleemphasis{NA} numerična odprtina vlakna, \sphinxstyleemphasis{n}$_{\text{0}}$, \sphinxstyleemphasis{n} $_{\text{J}}$in \sphinxstyleemphasis{n}$_{\text{P}}$ pa so lomni količniki \sphinxstyleemphasis{okolice}, \sphinxstyleemphasis{jedra} in \sphinxstyleemphasis{plašča}.

\sphinxAtStartPar
Če optično vlakno ukrivimo lahko ugotovimo, da intenziteta izstopne svetlobe pade. Zakaj? Na ukrivljenem delu se v tem primeru meja med jedrom in plaščem nagnjena glede na žarek in tako je za del žarkov vpadni kot zmanjšan. Žarki, za katere se vpadni kot zmanjša pod dopustno mejo (\({\Theta_C}\)), iz vlakna izidejo in na pridejo do konca vlakna (\sphinxstyleemphasis{slika 1}).

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.3]{{bend_radius}.png}
\caption{Slika 1. Na levi strani je skica pogojev, ki nastopijo pri krivljenju vlakna za premajhen radij, na desni strani pa ukrivljenost še omogoča vodenje žarka.}\label{\detokenize{vlakenski_senzorji:id2}}\end{figure}

\sphinxAtStartPar
Omenjeni pojav je običajno neželen, saj nas omejuje v možnostih, kako lahko vlakno položimo. A pojav lahko tudi izkoristimo v naš prid. Shema sistema za merjenje pomika na osnovi ocenjevanja zmanjševanja izhodne intenzitete je vidna na \sphinxstyleemphasis{sliki 2}. Svetlobo od laserskega vira vodimo po optičnem vlaknu do fotodiode, ki meri količino vpadle svetlobe. S pomočjo sistema »grabljic« v osrednjem delu vlakno krivimo. Pri tem so spodnje grabljice nepremične, zgornje pa lahko primikamo ali odmikamo in tako spreminjamo ukrivljenost vlakna. Bolj ko bodo »grabljice« primaknjene, bolj bo vlakno ukrivljeno in manjša bo inteziteta na diodo vpadle svetlobe.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.3]{{vilice}.png}
\caption{Slika 2. Sistem “grabljic”.}\label{\detokenize{vlakenski_senzorji:id3}}\end{figure}


\section{Vlakenski fluorescentni termometer}
\label{\detokenize{vlakenski_senzorji:vlakenski-fluorescentni-termometer}}
\sphinxAtStartPar
\sphinxstylestrong{Fluorescenca} imenujemo pojav, ko snov odda svetlobo po tem, ko je predhodno svetlobo ali drugo elektromagnetno valovanje absorbirala. Pojav se široko izkorišča; predstavljajte si le fluorescentne premaze na naprimer urah in fluorescentna svetila.
Eden izmed materialov, ki fluorescira, je kristal rubina (aluminijev oksid dupiran s kromovimi ioni, \sphinxstyleemphasis{Al}$_{\text{2}}$\sphinxstyleemphasis{O}$_{\text{3}}$\sphinxstyleemphasis{Cr}). Prav ta kristal je bil uporabljen tudi v prvem delujočem laserskem viru (\sphinxstyleemphasis{T. H. Maiman, 1960}). Gre za tronivojski sistem, ki je prikazan na \sphinxstyleemphasis{sliki 3}.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.3]{{rubinovi_laserski_nivoji}.png}
\caption{Slika 3. Energijski nivoji rubinovega laserja.}\label{\detokenize{vlakenski_senzorji:id4}}\end{figure}

\sphinxAtStartPar
Atomi v kristalu se običajno nahajajo v osnovnem energijskem stanju \sphinxstyleemphasis{E1}. Če ga obsevamo z zeleno svetlobo valovne dolžine približno \sphinxstyleemphasis{532 nm}, bodo atomi začeli prehajati v energijsko stanje \sphinxstyleemphasis{E2}, kjer pa lahko obstanejo le kratek čas (nekaj \sphinxstyleemphasis{10 ps}). Hitro bodo prešli v metastabilno stanje \sphinxstyleemphasis{E3}, kjer pa lahko obstanejo precej dlje, nekaj milisekund. Ob prehodu v osnovno energijsko stanje \sphinxstyleemphasis{E1} bodo energijo oddali v obliki spontane emisije \textendash{} fotonov z valovno dolžino \sphinxstyleemphasis{694,3 nm}.

\sphinxAtStartPar
Kako hitro se bo zgodil prehod iz metastabilnega v osnovno stanje, opisuje razpolovni čas \sphinxstyleemphasis{τ}. Ta pa je odvisen predvsem od temperature snovi; bolj kot je snov segreta, večja je amplituda nihanja kristalne rešetke, laže odda molekula energijo drugi molekuli. Tako se bo snov še dodatno segrevala (manjši bo izkoristek), \sphinxstyleemphasis{τ} pa se bo skrajšal.

\sphinxAtStartPar
Časovni potek prehajanja molekul v osnovno stanje in oddajanja svetlobe lahko opišemo z eksponentno enačbo:
\begin{equation*}
\begin{split}I(t) = I_{0} \cdot  e ^ {- \frac{t}{τ}}\end{split}
\end{equation*}
\sphinxAtStartPar
kjer je \({I_{0}}\) začetna intenziteta.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.3]{{vilice}.png}
\caption{Slika 4. Intenziteta oddane svetlobe v odvisnosti od časa. S povečevanjem temperature snovi se τ krajša.}\label{\detokenize{vlakenski_senzorji:id5}}\end{figure}


\subsection{Potek vaje}
\label{\detokenize{vlakenski_senzorji:potek-vaje}}
\sphinxAtStartPar
Za merjenje temperature boste uporabljali vlakno, ki ima na konici v epoksidno smolo vmešan fluorescentni rubinov prah (\sphinxstyleemphasis{slika 4}). Vzbujali ga bomo z zeleno lasersko svetlobo, ki jo bomo vodili po vlaknu. Ta bo vzbudila rubinov prah, ki bo fluoresciral še nekaj milisekund po tem, ko bomo laserski vir ugasnili. Del oddane svetlobe rubina bo potoval po vlaknu proti fotodiodi.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.3]{{vlakno}.png}
\caption{Slika 5. Skica vlakenskega senzorja za merjenje temperature.}\label{\detokenize{vlakenski_senzorji:id6}}\end{figure}



\renewcommand{\indexname}{Index}
\printindex
\end{document}